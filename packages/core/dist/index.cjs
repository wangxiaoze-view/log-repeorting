function getGlobalThis(){return"undefined"!=typeof window?window:{}}function getGlobalSupport(){return _global.__log_reporting__=_global.__log_reporting__||{},_global.__log_reporting__}let _global=getGlobalThis(),_support=getGlobalSupport(),_log=console.log;class Logger{constructor(){}log(e,t){_log(`%c${e}%c `+t,"color: #fff;font-weight: blod;letter-spacing:2px;padding: 3px 5px;background-color: #73767a;border-radius: 3px;","color: #909399;font-weight: blod;letter-spacing:2px;padding: 3px 5px;")}info(e,t){_log(`%c${e}%c `+t,"color: #fff;font-weight: blod;letter-spacing:2px;padding: 3px 5px;background-color: #337ecc;border-radius: 3px;","color: #409EFF;font-weight: blod;letter-spacing:2px;padding: 3px 5px;")}warn(e,t){_log(`%c${e}%c `+t,"color: #fff;font-weight: blod;letter-spacing:2px;padding: 3px 5px;background-color: #b88230;border-radius: 3px;","color: #E6A23C;font-weight: blod;letter-spacing:2px;padding: 3px 5px;")}error(e,t){_log(`%c${e}%c `+t,"color: #fff;font-weight: blod;letter-spacing:2px;padding: 3px 5px;background-color: #c45656;border-radius: 3px;","color: #F56C6C;font-weight: blod;letter-spacing:2px;padding: 3px 5px;")}success(e,t){_log(`%c${e}%c `+t,"color: #fff;font-weight: blod;letter-spacing:2px;padding: 3px 5px;background-color: #529b2e;border-radius: 3px;","color: #67C23A;font-weight: blod;letter-spacing:2px;padding: 3px 5px;")}}let logger=new Logger;function verifyBase(e){return!(!e.dsn||"string"!=typeof e.dsn)||(logger.error("dsn参数错误","dsn地址应该为 [字符串], 例如: https://www.wangxiaoze.wang"),!1)}function isKeyValid(e,t){return Object.prototype.hasOwnProperty.call(t,e)}function on$1(e,t,r,o=!1){e.addEventListener(t,r,o)}function getNavigation(e){var{domainLookupEnd:e,domainLookupStart:t,connectEnd:r,connectStart:o,secureConnectionStart:n,responseStart:s,requestStart:a,domInteractive:i,domComplete:l,loadEventEnd:c,loadEventStart:d,fetchStart:u}=e;return{dns:e-t,tcp:r-o,ssl:n,ttfb:s-a,render:null!=i?i:0,dom:null!=l?l:0,load:(null!=c?c:0)-(null!=d?d:0),total:(null!=c?c:0)-(null!=u?u:0)}}function getParams(e){var t,r,o={};for([t,r]of new URLSearchParams(e).entries())o[t]=r;return o}logger.log,logger,logger,logger,logger;class BaseInfo{constructor(e){this.options=e}}let baseInfo;function initBaseOptions(e){baseInfo=new BaseInfo(e),_support.baseInfo=baseInfo}exports.EVENT_TYPES=void 0,(e=>{e.ERROR="error",e.UNHANDLEDREJECTION="unhandledrejection",e.CONSOLE_ERROR="consoleError",e.XHR="xhr",e.FETCH="fetch",e.PV="pv",e.EXPOSURE="exposure"})(exports.EVENT_TYPES||(exports.EVENT_TYPES={})),exports.ERROR_TYPES=void 0,(e=>{e.JS="js_error",e.PROMISE="promise_error",e.CONSOLE_ERROR="console_error",e.XHR="xhr_error",e.FETCH="fetch_error"})(exports.ERROR_TYPES||(exports.ERROR_TYPES={}));class EventBus{constructor(){this._eventMap=new Map}static getInstance(){return this._instance||(this._instance=new EventBus),this._instance}on(e,t){this._eventMap.has(e)||this._eventMap.set(e,[]),null!=(e=this._eventMap.get(e))&&e.push(t)}emit(e,...t){this._eventMap.has(e)&&null!=(e=this._eventMap.get(e))&&e.forEach(e=>{e(...t)})}off(r,o){var e;this._eventMap.has(r)&&null!=(e=this._eventMap.get(r))&&e.forEach((e,t)=>{e===o&&null!=(e=this._eventMap.get(r))&&e.splice(t,1)})}once(r,o){var e;this._eventMap.has(r)&&null!=(e=this._eventMap.get(r))&&e.forEach((e,t)=>{e===o&&null!=(e=this._eventMap.get(r))&&e.splice(t,1)})}}let eventBus=_support.eventBus||(_support.eventBus=EventBus.getInstance());function support(e){return e in navigator?navigator[e]:"该浏览器不支持!"}function getNavigator(){return{platform:support("platform"),appName:support("appName"),appVersion:support("appVersion"),appCodeName:support("appCodeName"),vendor:support("vendor"),userAgent:support("userAgent"),onLine:support("onLine"),language:support("language"),product:support("product"),productSub:support("productSub"),windowWidth:window.screen.width,windowHeight:window.screen.height,colorDepth:window.screen.colorDepth}}function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var lzString={exports:{}},lzStringExports=(lzString.exports,(e=>{I=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};var I,r,o,n,a,t=a={compressToBase64:function(e){if(null==e)return"";var t=a._compress(e,6,function(e){return r.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:a._decompress(t.length,32,function(e){return s(r,t.charAt(e))})},compressToUTF16:function(e){return null==e?"":a._compress(e,15,function(e){return I(e+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:a._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(e){for(var t=a.compress(e),r=new Uint8Array(2*t.length),o=0,n=t.length;o<n;o++){var s=t.charCodeAt(o);r[2*o]=s>>>8,r[2*o+1]=s%256}return r},decompressFromUint8Array:function(e){if(null==e)return a.decompress(e);for(var t=new Array(e.length/2),r=0,o=t.length;r<o;r++)t[r]=256*e[2*r]+e[2*r+1];var n=[];return t.forEach(function(e){n.push(I(e))}),a.decompress(n.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":a._compress(e,6,function(e){return o.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),a._decompress(t.length,32,function(e){return s(o,t.charAt(e))}))},compress:function(e){return a._compress(e,16,function(e){return I(e)})},_compress:function(e,t,r){if(null==e)return"";for(var o,n,s,a,i={},l={},c="",d=2,u=3,p=2,g=[],h=0,m=0,f=0;f<e.length;f+=1)if(s=e.charAt(f),Object.prototype.hasOwnProperty.call(i,s)||(i[s]=u++,l[s]=!0),a=c+s,Object.prototype.hasOwnProperty.call(i,a))c=a;else{if(Object.prototype.hasOwnProperty.call(l,c)){if(c.charCodeAt(0)<256){for(o=0;o<p;o++)h<<=1,m==t-1?(m=0,g.push(r(h)),h=0):m++;for(n=c.charCodeAt(0),o=0;o<8;o++)h=h<<1|1&n,m==t-1?(m=0,g.push(r(h)),h=0):m++,n>>=1}else{for(n=1,o=0;o<p;o++)h=h<<1|n,m==t-1?(m=0,g.push(r(h)),h=0):m++,n=0;for(n=c.charCodeAt(0),o=0;o<16;o++)h=h<<1|1&n,m==t-1?(m=0,g.push(r(h)),h=0):m++,n>>=1}0==--d&&(d=Math.pow(2,p),p++),delete l[c]}else for(n=i[c],o=0;o<p;o++)h=h<<1|1&n,m==t-1?(m=0,g.push(r(h)),h=0):m++,n>>=1;0==--d&&(d=Math.pow(2,p),p++),i[a]=u++,c=String(s)}if(""!==c){if(Object.prototype.hasOwnProperty.call(l,c)){if(c.charCodeAt(0)<256){for(o=0;o<p;o++)h<<=1,m==t-1?(m=0,g.push(r(h)),h=0):m++;for(n=c.charCodeAt(0),o=0;o<8;o++)h=h<<1|1&n,m==t-1?(m=0,g.push(r(h)),h=0):m++,n>>=1}else{for(n=1,o=0;o<p;o++)h=h<<1|n,m==t-1?(m=0,g.push(r(h)),h=0):m++,n=0;for(n=c.charCodeAt(0),o=0;o<16;o++)h=h<<1|1&n,m==t-1?(m=0,g.push(r(h)),h=0):m++,n>>=1}0==--d&&(d=Math.pow(2,p),p++),delete l[c]}else for(n=i[c],o=0;o<p;o++)h=h<<1|1&n,m==t-1?(m=0,g.push(r(h)),h=0):m++,n>>=1;0==--d&&(d=Math.pow(2,p),p++)}for(n=2,o=0;o<p;o++)h=h<<1|1&n,m==t-1?(m=0,g.push(r(h)),h=0):m++,n>>=1;for(;;){if(h<<=1,m==t-1){g.push(r(h));break}m++}return g.join("")},decompress:function(t){return null==t?"":""==t?null:a._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(e,t,r){for(var o,n,s,a,i,l,c=[],d=4,u=4,p=3,g="",h=[],m={val:r(0),position:t,index:1},f=0;f<3;f+=1)c[f]=f;for(n=0,a=Math.pow(2,2),i=1;i!=a;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=t,m.val=r(m.index++)),n|=(0<s?1:0)*i,i<<=1;switch(n){case 0:for(n=0,a=Math.pow(2,8),i=1;i!=a;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=t,m.val=r(m.index++)),n|=(0<s?1:0)*i,i<<=1;l=I(n);break;case 1:for(n=0,a=Math.pow(2,16),i=1;i!=a;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=t,m.val=r(m.index++)),n|=(0<s?1:0)*i,i<<=1;l=I(n);break;case 2:return""}for(o=c[3]=l,h.push(l);;){if(e<m.index)return"";for(n=0,a=Math.pow(2,p),i=1;i!=a;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=t,m.val=r(m.index++)),n|=(0<s?1:0)*i,i<<=1;switch(l=n){case 0:for(n=0,a=Math.pow(2,8),i=1;i!=a;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=t,m.val=r(m.index++)),n|=(0<s?1:0)*i,i<<=1;c[u++]=I(n),l=u-1,d--;break;case 1:for(n=0,a=Math.pow(2,16),i=1;i!=a;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=t,m.val=r(m.index++)),n|=(0<s?1:0)*i,i<<=1;c[u++]=I(n),l=u-1,d--;break;case 2:return h.join("")}if(0==d&&(d=Math.pow(2,p),p++),c[l])g=c[l];else{if(l!==u)return null;g=o+o.charAt(0)}h.push(g),c[u++]=o+g.charAt(0),o=g,0==--d&&(d=Math.pow(2,p),p++)}}};function s(e,t){if(!n[e]){n[e]={};for(var r=0;r<e.length;r++)n[e][e.charAt(r)]=r}return n[e][t]}null!=e?e.exports=t:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",function(){return t})})(lzString),lzString.exports),lz=getDefaultExportFromCjs(lzStringExports);let version$1="3.7.7",VERSION=version$1,_hasBuffer="function"==typeof Buffer,_TD="function"==typeof TextDecoder?new TextDecoder:void 0,_TE="function"==typeof TextEncoder?new TextEncoder:void 0,b64ch="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b64chs=Array.prototype.slice.call(b64ch),b64tab=(e=>{let r={};return e.forEach((e,t)=>r[e]=t),r})(b64chs),b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,_fromCC=String.fromCharCode.bind(String),_U8Afrom="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),_mkUriSafe=e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"),_tidyB64=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),btoaPolyfill=t=>{let r,o,n,s,a="";var e=t.length%3;for(let e=0;e<t.length;){if(255<(o=t.charCodeAt(e++))||255<(n=t.charCodeAt(e++))||255<(s=t.charCodeAt(e++)))throw new TypeError("invalid character found");r=o<<16|n<<8|s,a+=b64chs[r>>18&63]+b64chs[r>>12&63]+b64chs[r>>6&63]+b64chs[63&r]}return e?a.slice(0,e-3)+"===".substring(e):a},_btoa="function"==typeof btoa?e=>btoa(e):_hasBuffer?e=>Buffer.from(e,"binary").toString("base64"):btoaPolyfill,_fromUint8Array=_hasBuffer?e=>Buffer.from(e).toString("base64"):r=>{var o=[];for(let e=0,t=r.length;e<t;e+=4096)o.push(_fromCC.apply(null,r.subarray(e,e+4096)));return _btoa(o.join(""))},fromUint8Array=(e,t=!1)=>t?_mkUriSafe(_fromUint8Array(e)):_fromUint8Array(e),cb_utob=e=>{var t;return e.length<2?(t=e.charCodeAt(0))<128?e:t<2048?_fromCC(192|t>>>6)+_fromCC(128|63&t):_fromCC(224|t>>>12&15)+_fromCC(128|t>>>6&63)+_fromCC(128|63&t):(t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320),_fromCC(240|t>>>18&7)+_fromCC(128|t>>>12&63)+_fromCC(128|t>>>6&63)+_fromCC(128|63&t))},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=e=>e.replace(re_utob,cb_utob),_encode=_hasBuffer?e=>Buffer.from(e,"utf8").toString("base64"):_TE?e=>_fromUint8Array(_TE.encode(e)):e=>_btoa(utob(e)),encode$1=(e,t=!1)=>t?_mkUriSafe(_encode(e)):_encode(e),encodeURI=e=>encode$1(e,!0),re_btou=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cb_btou=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return _fromCC(55296+(t>>>10))+_fromCC(56320+(1023&t));case 3:return _fromCC((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return _fromCC((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=e=>e.replace(re_btou,cb_btou),atobPolyfill=t=>{if(t=t.replace(/\s+/g,""),!b64re.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(3&t.length));let r,o="",n,s;for(let e=0;e<t.length;)r=b64tab[t.charAt(e++)]<<18|b64tab[t.charAt(e++)]<<12|(n=b64tab[t.charAt(e++)])<<6|(s=b64tab[t.charAt(e++)]),o+=64===n?_fromCC(r>>16&255):64===s?_fromCC(r>>16&255,r>>8&255):_fromCC(r>>16&255,r>>8&255,255&r);return o},_atob="function"==typeof atob?e=>atob(_tidyB64(e)):_hasBuffer?e=>Buffer.from(e,"base64").toString("binary"):atobPolyfill,_toUint8Array=_hasBuffer?e=>_U8Afrom(Buffer.from(e,"base64")):e=>_U8Afrom(_atob(e).split("").map(e=>e.charCodeAt(0))),toUint8Array=e=>_toUint8Array(_unURI(e)),_decode=_hasBuffer?e=>Buffer.from(e,"base64").toString("utf8"):_TD?e=>_TD.decode(_toUint8Array(e)):e=>btou(_atob(e)),_unURI=e=>_tidyB64(e.replace(/[-_]/g,e=>"-"==e?"+":"/")),decode=e=>_decode(_unURI(e)),isValid=e=>"string"==typeof e&&(e=e.replace(/\s+/g,"").replace(/={0,2}$/,""),!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)),_noEnum=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),extendString=function(){var e=(e,t)=>Object.defineProperty(String.prototype,e,_noEnum(t));e("fromBase64",function(){return decode(this)}),e("toBase64",function(e){return encode$1(this,e)}),e("toBase64URI",function(){return encode$1(this,!0)}),e("toBase64URL",function(){return encode$1(this,!0)}),e("toUint8Array",function(){return toUint8Array(this)})},extendUint8Array=function(){var e=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,_noEnum(t));e("toBase64",function(e){return fromUint8Array(this,e)}),e("toBase64URI",function(){return fromUint8Array(this,!0)}),e("toBase64URL",function(){return fromUint8Array(this,!0)})},extendBuiltins=()=>{extendString(),extendUint8Array()},gBase64={version:version$1,VERSION:VERSION,atob:_atob,atobPolyfill:atobPolyfill,btoa:_btoa,btoaPolyfill:btoaPolyfill,fromBase64:decode,toBase64:encode$1,encode:encode$1,encodeURI:encodeURI,encodeURL:encodeURI,utob:utob,btou:btou,decode:decode,isValid:isValid,fromUint8Array:fromUint8Array,toUint8Array:toUint8Array,extendString:extendString,extendUint8Array:extendUint8Array,extendBuiltins:extendBuiltins};function encryptFun(e,t){var e=JSON.stringify(e),r=_support.baseInfo.options.encryptMethod;return"lz"===r?lz.compress(e):gBase64.encode(e)}function decryptionFun(e,t){var r=_support.baseInfo.options.encryptMethod;return"lz"===r?lz.decompress(e):gBase64.decode(e)}function sendBeacon(t,r){return new Promise(e=>{navigator.sendBeacon(t,r),e(!0)})}function sendXhr(r,o){return new Promise(e=>{let t=new XMLHttpRequest;t.open("post",r,!0),t.setRequestHeader("Content-Type","application/json"),t.send(o),e(!0),t.onreadystatechange=function(){4===t.readyState&&e(!0)}})}function sendReport(e,n){if(_support.baseInfo.options.isReport){e={appId:_support.baseInfo.options.appId,baseInfo:Object.assign({title:document.title,url:location.href,date:Date.now()},getNavigator()),reportInfo:Object.assign({eventId:e,snapshot:encryptFun(_support.record.snapshot,"snapshot")},n)};let t=_support.baseInfo.options.dsn,r=null!=(n=_support.baseInfo.options.method)?n:"beacon",o=JSON.stringify(e);return new Promise(e=>{switch(r){case"beacon":sendBeacon(t,o).then(()=>{e({type:"xhr",success:!0})});break;case"xhr":sendXhr(t,o).then(()=>{e({type:"xhr",success:!0})});break;default:logger.warn("上报方式不支持:","上报方式只支持 'beacon' 和 'xhr'")}})}}function initPushError(){for(var e in exports.EVENT_TYPES)isKeyValid(e,exports.EVENT_TYPES)&&pushFun(e)}function pushFun(e){if(isKeyValid(e,exports.EVENT_TYPES)){var t=exports.EVENT_TYPES[e];switch(t){case exports.EVENT_TYPES.ERROR:pushError(t);break;case exports.EVENT_TYPES.CONSOLE_ERROR:pushConsole(t);break;case exports.EVENT_TYPES.UNHANDLEDREJECTION:pushUnhandledrejection(t);break;case exports.EVENT_TYPES.XHR:pushXhr(t);break;case exports.EVENT_TYPES.FETCH:pushFetch(t)}}}function pushError(t){eventBus.on(t,e=>{_support.baseInfo.options.isDebug&&logger.error("js逻辑错误：",JSON.stringify(e)),sendReport(t,e)})}function pushConsole(t){eventBus.on(t,e=>{_support.baseInfo.options.isDebug&&logger.info("console错误：",JSON.stringify(e)),sendReport(t,e)})}function pushUnhandledrejection(t){eventBus.on(t,e=>{_support.baseInfo.options.isDebug&&logger.error("Promise错误：",JSON.stringify(e)),sendReport(t,e)})}function pushXhr(t){"XMLHttpRequest"in _global&&eventBus.on(t,e=>{_support.baseInfo.options.isDebug&&logger.error("xhr接口错误：",JSON.stringify(e)),sendReport(t,e)})}function pushFetch(t){"fetch"in _global&&eventBus.on(t,e=>{_support.baseInfo.options.isDebug&&logger.error("fetch接口错误：",JSON.stringify(e)),sendReport(t,e)})}let lastEvent;function getErrorEle(){return lastEvent}function formatStack(e,t=1){return(e||"").split("\n").slice(t).map(e=>e.replace(/^\s+at\s+/g,"")).join("~~")}function getErrorStackLine(e){var t={errorMessage:"",time:Date.now(),colno:0,lineno:0,stackMessage:"",fileName:""};try{var r,o,n,s,a=/http[s]?:\/\/[^:]+(:\d+)?\/([^:]+):(\d+):(\d+)/,i=formatStack(e.stack).split("~~")[1];return i?(r=i.match(a))?(o=r[2],n=parseInt(r[3],10),s=parseInt(r[4],10),{errorMessage:e.message,time:Date.now(),colno:s,lineno:n,stackMessage:formatStack(e.stack),fileName:o}):t:t}catch(e){return t}}function getErrorElInfo(e){var t,e=e||getErrorEle();let r={};return r=e?{pointerId:e.pointerId,pointerType:e.pointerType,timeStamp:e.timeStamp,type:e.type,layerX:e.x,layerY:e.y,nodeName:null!=(t=e.nodeName)?t:e.target.nodeName,nodeType:null!=(t=e.nodeType)?t:e.target.nodeType,textContent:null!=(t=e.textContent)?t:e.target.textContent,className:null!=(t=e.className)?t:e.target.className,elId:null!=(t=e.id)?t:e.target.id}:r}function getError(e){var t=getErrorStackLine(e);let r;return r=t.stackMessage?t:{errorMessage:e.error?e.error.message:"",stackMessage:formatStack(null==(t=e.error)?void 0:t.stack),lineno:e.lineno,colno:e.colno,fileName:e.filename,time:Date.now()},Object.assign(Object.assign({bubbles:e.bubbles,eventType:e.type,isTrusted:e.isTrusted},r),{time:Date.now(),timeStamp:Math.round(e.timeStamp),el:getErrorElInfo()})}function getPromiseError(e){let t,r,o=0,n=0,s="";var a,i=e.reason;return"string"==typeof i?t=i:"object"==typeof i&&(t=i.message,i.stack&&(a=i.stack.match(/at\s+(.+):(\d+):(\d+)/),r=a[1],n=a[2],o=a[3]),s=formatStack(i.stack)),Object.assign(Object.assign({},getError(e)),{errorMessage:t,stackMessage:s,fileName:r,lineno:Number(n),colno:Number(o)})}function getXhrError(e,t){return Object.assign(Object.assign({},getError(e)),{questOptions:t})}function getFetchError(e,t={}){return Object.assign({questOptions:e,el:getErrorElInfo()},t)}function initReWrite(){for(var e in exports.EVENT_TYPES)isKeyValid(e,exports.EVENT_TYPES)&&reWriteFun(e)}function reWriteFun(e){if(isKeyValid(e,exports.EVENT_TYPES)){var t=exports.EVENT_TYPES[e];switch(t){case exports.EVENT_TYPES.ERROR:listenError(t);break;case exports.EVENT_TYPES.CONSOLE_ERROR:listenConsole(t);break;case exports.EVENT_TYPES.UNHANDLEDREJECTION:listenUnhandledrejection(t);break;case exports.EVENT_TYPES.XHR:listenXhr(t);break;case exports.EVENT_TYPES.FETCH:listenFetch(t)}}}function listenError(t){_support.baseInfo.options.isError&&on$1(_global,t,e=>eventBus.emit(t,Object.assign({errorType:exports.ERROR_TYPES.JS},getError(e))),!0)}function listenConsole(o){if(_support.baseInfo.options.isConsoleError){let r=console.error;console.error=function(...e){var t=e.map(e=>"string"==typeof e?e:JSON.stringify(e)).join(" "),t=new Error(t);eventBus.emit(o,Object.assign({errorType:exports.ERROR_TYPES.CONSOLE_ERROR},getErrorStackLine(t))),r.apply(console,e)}}}function listenUnhandledrejection(t){_support.baseInfo.options.isError&&on$1(_global,t,e=>eventBus.emit(t,Object.assign({errorType:exports.ERROR_TYPES.PROMISE},getPromiseError(e))))}function listenXhr(a){if(_support.baseInfo.options.isXhr&&"XMLHttpRequest"in _global){let n={},s=XMLHttpRequest.prototype.send,r=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,t){return n.method=e,n.url=t,r.call(this,e,t,!0)},XMLHttpRequest.prototype.send=function(e){var t;["get","delete"].includes(n.method.toLowerCase())&&n.url&&-1!==n.url.indexOf("?")&&(t=null==(t=n.url)?void 0:t.substring(n.url.indexOf("?")+1),n.params=getParams(t));let r=()=>({method:n.method.toLowerCase(),url:n.url||"",status:this.status,params:"string"==typeof(e||n.params)?e||n.params:JSON.stringify(e||n.params),message:this.statusText}),o={errorType:exports.ERROR_TYPES.XHR};return this.addEventListener("readystatechange",e=>{4===this.readyState&&(this.status<200||300<=this.status)&&eventBus.emit(a,Object.assign(Object.assign({},o),getXhrError(e,r())))}),this.addEventListener("error",e=>{eventBus.emit(a,Object.assign(Object.assign({},o),getXhrError(e,r())))},!1),this.addEventListener("abort",e=>{eventBus.emit(a,Object.assign(Object.assign({},o),getXhrError(e,r())))},!1),s.call(this,e)}}}function listenFetch(a){if(_support.baseInfo.options.isXhr&&"fetch"in _global){let o=_global.fetch,n={},s={errorType:exports.ERROR_TYPES.FETCH};_global.fetch=function(e,t={}){var{method:r="GET"}=t||{method:"GET"},r=(n.method=r.toLowerCase(),n.url=e.toString(),["get","delete"].includes(n.method.toLowerCase())&&n.url&&(r=null==(r=n.url)?void 0:r.substring(n.url.indexOf("?")+1),n.params=getParams(r)),["post","put"].includes(n.method.toLowerCase())&&(n.params=JSON.stringify(t.body||{})),o(e,t));return r.then(t=>{(t.status<200||300<=t.status)&&t.text().then(()=>{var e={method:n.method.toLowerCase(),url:n.url||"",status:t.status,params:n.params||{},message:t.statusText};eventBus.emit(a,Object.assign(Object.assign({},s),getFetchError(e)))})},e=>{var t={method:n.method.toLowerCase(),url:n.url||"",status:500,params:n.params||{},message:"请求失败"};eventBus.emit(a,Object.assign(Object.assign({},s),getFetchError(t,getErrorStackLine(e))))}),r}}}["click","touchstart","mousedown","keydown","mouseover"].forEach(e=>{document.addEventListener(e,e=>{lastEvent=e},{capture:!0,passive:!0})});var NodeType,name="@log-reporting/core",version="1.0.8",description="前端日志上报SDK",homepage="https://github.com/wangxiaoze-view/log-repeorting#readme",main$1="./dist/index.cjs",module$1="./dist/index.mjs",types="./dist/types/index.d.ts",unpkg="./dist/index.iife.min.js",jsdelivr="./dist/index.iife.min.js",sideEffects=!1,exports$1={".":{import:"./dist/index.mjs",require:"./dist/index.cjs",types:"./dist/index.d.ts"}},files=["dist","*.d.ts"],license="MIT",repository={type:"git",url:"git+https://github.com/wangxiaoze-view/log-repeorting.git",directory:"packages/core"},author="王小泽 <wangze@anbangke.com>",keywords=["log","log-repeorting","rollup","rrweb","typescript","埋点","日志","采集"],publishConfig={registry:"https://registry.npmjs.org/"},bugs={url:"https://github.com/wangxiaoze-view/log-repeorting/issues"},dependencies={"@types/crypto-js":"^4.2.2","js-base64":"^3.7.7","lz-string":"^1.5.0",rrweb:"^2.0.0-alpha.4"},devDependencies={"@rrweb/types":"2.0.0-alpha.17"},pck={name:name,version:version,description:description,homepage:homepage,main:main$1,module:module$1,types:types,unpkg:unpkg,jsdelivr:jsdelivr,sideEffects:sideEffects,exports:exports$1,files:files,license:license,repository:repository,author:author,keywords:keywords,publishConfig:publishConfig,bugs:bugs,dependencies:dependencies,devDependencies:devDependencies};class PerformanceClass{constructor(e){this.data=e}}let performance;function initPerformanceOptions(e){var t;null!=(t=null==(t=_support.baseInfo)?void 0:t.options)&&t.isPerformance&&(performance=new PerformanceClass(e),_support.performance=performance)}class Reource{constructor(e){this.data=e}}let reource;function initReourceOptions(e){var t;null!=(t=null==(t=_support.baseInfo)?void 0:t.options)&&t.isResource&&(reource=new Reource(e),_support.reource=reource)}function initPerformance(){var e=new PerformanceObserver(()=>{}),e=(e.observe({type:"navigation",buffered:!0}),e.observe({type:"resource",buffered:!0}),e.takeRecords()),t=e.find(e=>"navigation"===e.entryType),t=(t&&initPerformanceOptions(getNavigation(t)),e.filter(e=>"resource"===e.entryType));initReourceOptions(t)}function isElement(e){return e.nodeType===e.ELEMENT_NODE}function isShadowRoot(e){var t=null==e?void 0:e.host;return Boolean((null==t?void 0:t.shadowRoot)===e)}function isNativeShadowDom(e){return"[object ShadowRoot]"===Object.prototype.toString.call(e)}function fixBrowserCompatibilityIssuesInCSS(e){return e=e.includes(" background-clip: text;")&&!e.includes(" -webkit-background-clip: text;")?e.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;"):e}function getCssRulesString(e){try{var t=e.rules||e.cssRules;return t?fixBrowserCompatibilityIssuesInCSS(Array.from(t).map(getCssRuleString).join("")):null}catch(e){return null}}function getCssRuleString(e){var t=e.cssText;if(isCSSImportRule(e))try{t=getCssRulesString(e.styleSheet)||t}catch(e){}return t}function isCSSImportRule(e){return"styleSheet"in e}(e=>{e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"})(NodeType=NodeType||{});var Mirror=(()=>{function e(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return e.prototype.getId=function(e){return e&&null!=(e=null==(e=this.getMeta(e))?void 0:e.id)?e:-1},e.prototype.getNode=function(e){return this.idNodeMap.get(e)||null},e.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},e.prototype.getMeta=function(e){return this.nodeMetaMap.get(e)||null},e.prototype.removeNodeFromMap=function(e){var t=this,r=this.getId(e);this.idNodeMap.delete(r),e.childNodes&&e.childNodes.forEach(function(e){return t.removeNodeFromMap(e)})},e.prototype.has=function(e){return this.idNodeMap.has(e)},e.prototype.hasNode=function(e){return this.nodeMetaMap.has(e)},e.prototype.add=function(e,t){var r=t.id;this.idNodeMap.set(r,e),this.nodeMetaMap.set(e,t)},e.prototype.replace=function(e,t){var r=this.getNode(e);r&&(r=this.nodeMetaMap.get(r))&&this.nodeMetaMap.set(t,r),this.idNodeMap.set(e,t)},e.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},e})();function createMirror(){return new Mirror}function maskInputValue(e){var t=e.maskInputOptions,r=e.tagName,o=e.type,n=e.maskInputFn,e=e.value||"";return e=t[r.toLowerCase()]||t[o]?n?n(e):"*".repeat(e.length):e}var ORIGINAL_ATTRIBUTE_NAME="__rrweb_original__";function is2DCanvasBlank(e){var t=e.getContext("2d");if(t)for(var r=0;r<e.width;r+=50)for(var o=0;o<e.height;o+=50){var n=t.getImageData,n=ORIGINAL_ATTRIBUTE_NAME in n?n[ORIGINAL_ATTRIBUTE_NAME]:n;if(new Uint32Array(n.call(t,r,o,Math.min(50,e.width-r),Math.min(50,e.height-o)).data.buffer).some(function(e){return 0!==e}))return!1}return!0}var canvasService,canvasCtx,_id=1,tagNameRegex=new RegExp("[^a-z0-9-_:]"),IGNORED_NODE=-2;function genId(){return _id++}function getValidTagName(e){return e instanceof HTMLFormElement?"form":(e=e.tagName.toLowerCase().trim(),tagNameRegex.test(e)?"div":e)}function stringifyStyleSheet(e){return e.cssRules?Array.from(e.cssRules).map(function(e){return e.cssText||""}).join(""):""}function extractOrigin(e){return(-1<e.indexOf("//")?e.split("/").slice(0,3).join("/"):e.split("/")[0]).split("?")[0]}var URL_IN_CSS_REF=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,RELATIVE_PATH=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,DATA_URI=/^(data:)([^,]*),(.*)/i;function absoluteToStylesheet(e,d){return(e||"").replace(URL_IN_CSS_REF,function(e,t,r,o,n,s){r=r||n||s,n=t||o||"";if(!r)return e;if(!RELATIVE_PATH.test(r))return"url(".concat(n).concat(r).concat(n,")");if(DATA_URI.test(r))return"url(".concat(n).concat(r).concat(n,")");if("/"===r[0])return"url(".concat(n).concat(extractOrigin(d)+r).concat(n,")");var a=d.split("/"),s=r.split("/");a.pop();for(var i=0,l=s;i<l.length;i++){var c=l[i];"."!==c&&(".."===c?a.pop():a.push(c))}return"url(".concat(n).concat(a.join("/")).concat(n,")")})}var SRCSET_NOT_SPACES=/^[^ \t\n\r\u000c]+/,SRCSET_COMMAS_OR_SPACES=/^[, \t\n\r\u000c]+/;function getAbsoluteSrcsetString(e,t){if(""===t.trim())return t;var r=0;function o(e){var e=e.exec(t.substring(r));return e?(e=e[0],r+=e.length,e):""}for(var n=[];o(SRCSET_COMMAS_OR_SPACES),!(r>=t.length);)if(","===(a=o(SRCSET_NOT_SPACES)).slice(-1))a=absoluteToDoc(e,a.substring(0,a.length-1)),n.push(a);else for(var s="",a=absoluteToDoc(e,a),i=!1;;){var l=t.charAt(r);if(""===l){n.push((a+s).trim());break}if(i)")"===l&&(i=!1);else{if(","===l){r+=1,n.push((a+s).trim());break}"("===l&&(i=!0)}s+=l,r+=1}return n.join(", ")}function absoluteToDoc(e,t){return t&&""!==t.trim()?((e=e.createElement("a")).href=t,e.href):t}function isSVGElement(e){return Boolean("svg"===e.tagName||e.ownerSVGElement)}function getHref(){var e=document.createElement("a");return e.href="",e.href}function transformAttribute(e,t,r,o){return"src"!==r&&("href"!==r||!o||"use"===t&&"#"===o[0])&&!("xlink:href"===r&&o&&"#"!==o[0]||"background"===r&&o&&("table"===t||"td"===t||"th"===t))?"srcset"===r&&o?getAbsoluteSrcsetString(e,o):"style"===r&&o?absoluteToStylesheet(o,getHref()):"object"===t&&"data"===r&&o?absoluteToDoc(e,o):o:absoluteToDoc(e,o)}function _isBlockedElement(e,t,r){if("string"==typeof t){if(e.classList.contains(t))return!0}else for(var o=e.classList.length;o--;){var n=e.classList[o];if(t.test(n))return!0}return!!r&&e.matches(r)}function classMatchesRegex(e,t,r){if(!e)return!1;if(e.nodeType!==e.ELEMENT_NODE)return!!r&&classMatchesRegex(e.parentNode,t,r);for(var o=e.classList.length;o--;){var n=e.classList[o];if(t.test(n))return!0}return!!r&&classMatchesRegex(e.parentNode,t,r)}function needMaskingText(e,t,r){e=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(null!==e){if("string"==typeof t){if(e.classList.contains(t))return!0;if(e.closest(".".concat(t)))return!0}else if(classMatchesRegex(e,t,!0))return!0;if(r){if(e.matches(r))return!0;if(e.closest(r))return!0}}return!1}function onceIframeLoaded(e,t,r){var o=e.contentWindow;if(o){var n,s,a=!1;try{s=o.document.readyState}catch(e){return}if("complete"===s)return o.location.href!==(s="about:blank")||e.src===s||""===e.src?(setTimeout(t,0),e.addEventListener("load",t)):void e.addEventListener("load",t);n=setTimeout(function(){a||(t(),a=!0)},r),e.addEventListener("load",function(){clearTimeout(n),a=!0,t()})}}function onceStylesheetLoaded(e,t,r){var o,n,s=!1;try{o=e.sheet}catch(e){return}o||(n=setTimeout(function(){s||(t(),s=!0)},r),e.addEventListener("load",function(){clearTimeout(n),s=!0,t()}))}function serializeNode(e,t){var r=t.doc,o=t.blockClass,n=t.blockSelector,s=t.maskTextClass,a=t.maskTextSelector,i=t.inlineStylesheet,l=t.maskInputOptions,c=void 0===l?{}:l,d=t.maskTextFn,u=t.maskInputFn,l=t.dataURLOptions,p=void 0===l?{}:l,g=t.inlineImages,h=t.recordCanvas,m=t.keepIframeSrcFn,l=t.newlyAddedElement,f=void 0!==l&&l,I=getRootId(r,t.mirror);switch(e.nodeType){case e.DOCUMENT_NODE:return"CSS1Compat"!==e.compatMode?{type:NodeType.Document,childNodes:[],compatMode:e.compatMode}:{type:NodeType.Document,childNodes:[]};case e.DOCUMENT_TYPE_NODE:return{type:NodeType.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:I};case e.ELEMENT_NODE:return serializeElementNode(e,{doc:r,blockClass:o,blockSelector:n,inlineStylesheet:i,maskInputOptions:c,maskInputFn:u,dataURLOptions:p,inlineImages:g,recordCanvas:h,keepIframeSrcFn:m,newlyAddedElement:f,rootId:I});case e.TEXT_NODE:return serializeTextNode(e,{maskTextClass:s,maskTextSelector:a,maskTextFn:d,rootId:I});case e.CDATA_SECTION_NODE:return{type:NodeType.CDATA,textContent:"",rootId:I};case e.COMMENT_NODE:return{type:NodeType.Comment,textContent:e.textContent||"",rootId:I};default:return!1}}function getRootId(e,t){return!t.hasNode(e)||1===(t=t.getId(e))?void 0:t}function serializeTextNode(t,e){var r,o=e.maskTextClass,n=e.maskTextSelector,s=e.maskTextFn,e=e.rootId,a=t.parentNode&&t.parentNode.tagName,i=t.textContent,l="STYLE"===a||void 0,a="SCRIPT"===a||void 0;if(l&&i){try{t.nextSibling||t.previousSibling||null!=(r=t.parentNode.sheet)&&r.cssRules&&(i=stringifyStyleSheet(t.parentNode.sheet))}catch(e){console.warn("Cannot get CSS styles from text's parentNode. Error: ".concat(e),t)}i=absoluteToStylesheet(i,getHref())}return a&&(i="SCRIPT_PLACEHOLDER"),!l&&!a&&i&&needMaskingText(t,o,n)&&(i=s?s(i):i.replace(/[\S]/g,"*")),{type:NodeType.Text,textContent:i||"",isStyle:l,rootId:e}}function serializeElementNode(t,e){for(var r,o,n,s=e.doc,a=e.inlineStylesheet,i=e.maskInputOptions,i=void 0===i?{}:i,l=e.maskInputFn,c=e.dataURLOptions,d=void 0===c?{}:c,c=e.inlineImages,u=e.recordCanvas,p=e.keepIframeSrcFn,g=e.newlyAddedElement,g=void 0!==g&&g,h=e.rootId,e=_isBlockedElement(t,e.blockClass,e.blockSelector),m=getValidTagName(t),f={},I=t.attributes.length,C=0;C<I;C++){var y=t.attributes[C];f[y.name]=transformAttribute(s,m,y.name,y.value)}return"link"===m&&a&&(n=null,n=(a=Array.from(s.styleSheets).find(function(e){return e.href===t.href}))?getCssRulesString(a):n)&&(delete f.rel,delete f.href,f._cssText=absoluteToStylesheet(n,a.href)),"style"===m&&t.sheet&&!(t.innerText||t.textContent||"").trim().length&&(n=getCssRulesString(t.sheet))&&(f._cssText=absoluteToStylesheet(n,getHref())),"input"!==m&&"textarea"!==m&&"select"!==m||(a=t.value,n=t.checked,"radio"!==f.type&&"checkbox"!==f.type&&"submit"!==f.type&&"button"!==f.type&&a?f.value=maskInputValue({type:f.type,tagName:m,value:a,maskInputOptions:i,maskInputFn:l}):n&&(f.checked=n)),"option"===m&&(t.selected&&!i.select?f.selected=!0:delete f.selected),"canvas"===m&&u&&("2d"===t.__context?is2DCanvasBlank(t)||(f.rr_dataURL=t.toDataURL(d.type,d.quality)):"__context"in t||(a=t.toDataURL(d.type,d.quality),(l=document.createElement("canvas")).width=t.width,l.height=t.height,a!==l.toDataURL(d.type,d.quality)&&(f.rr_dataURL=a))),"img"===m&&c&&(canvasService||(canvasService=s.createElement("canvas"),canvasCtx=canvasService.getContext("2d")),o=(r=t).crossOrigin,r.crossOrigin="anonymous",n=function(){try{canvasService.width=r.naturalWidth,canvasService.height=r.naturalHeight,canvasCtx.drawImage(r,0,0),f.rr_dataURL=canvasService.toDataURL(d.type,d.quality)}catch(e){console.warn("Cannot inline img src=".concat(r.currentSrc,"! Error: ").concat(e))}o?f.crossOrigin=o:r.removeAttribute("crossorigin")},r.complete&&0!==r.naturalWidth?n():r.onload=n),"audio"!==m&&"video"!==m||(f.rr_mediaState=t.paused?"paused":"played",f.rr_mediaCurrentTime=t.currentTime),g||(t.scrollLeft&&(f.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(f.rr_scrollTop=t.scrollTop)),e&&(u=(i=t.getBoundingClientRect()).width,l=i.height,f={class:f.class,rr_width:"".concat(u,"px"),rr_height:"".concat(l,"px")}),"iframe"!==m||p(f.src)||(t.contentDocument||(f.rr_src=f.src),delete f.src),{type:NodeType.Element,tagName:m,attributes:f,childNodes:[],isSVG:isSVGElement(t)||void 0,needBlock:e,rootId:h}}function lowerIfExists(e){return void 0===e?"":e.toLowerCase()}function slimDOMExcluded(e,t){if(t.comment&&e.type===NodeType.Comment)return!0;if(e.type===NodeType.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&"preload"===e.attributes.rel&&"script"===e.attributes.as||"link"===e.tagName&&"prefetch"===e.attributes.rel&&"string"==typeof e.attributes.href&&e.attributes.href.endsWith(".js")))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(lowerIfExists(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===lowerIfExists(e.attributes.name)||"icon"===lowerIfExists(e.attributes.rel)||"apple-touch-icon"===lowerIfExists(e.attributes.rel)||"shortcut icon"===lowerIfExists(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&lowerIfExists(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(lowerIfExists(e.attributes.property).match(/^(og|twitter|fb):/)||lowerIfExists(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===lowerIfExists(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===lowerIfExists(e.attributes.name)||"googlebot"===lowerIfExists(e.attributes.name)||"bingbot"===lowerIfExists(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===lowerIfExists(e.attributes.name)||"generator"===lowerIfExists(e.attributes.name)||"framework"===lowerIfExists(e.attributes.name)||"publisher"===lowerIfExists(e.attributes.name)||"progid"===lowerIfExists(e.attributes.name)||lowerIfExists(e.attributes.property).match(/^article:/)||lowerIfExists(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===lowerIfExists(e.attributes.name)||"yandex-verification"===lowerIfExists(e.attributes.name)||"csrf-token"===lowerIfExists(e.attributes.name)||"p:domain_verify"===lowerIfExists(e.attributes.name)||"verify-v1"===lowerIfExists(e.attributes.name)||"verification"===lowerIfExists(e.attributes.name)||"shopify-checkout-api-token"===lowerIfExists(e.attributes.name)))return!0}}return!1}function serializeNodeWithId(t,e){var r=e.doc,o=e.mirror,n=e.blockClass,s=e.blockSelector,a=e.maskTextClass,i=e.maskTextSelector,l=e.skipChild,l=void 0!==l&&l,c=e.inlineStylesheet,d=void 0===c||c,c=e.maskInputOptions,u=void 0===c?{}:c,p=e.maskTextFn,g=e.maskInputFn,h=e.slimDOMOptions,c=e.dataURLOptions,m=void 0===c?{}:c,c=e.inlineImages,f=void 0!==c&&c,c=e.recordCanvas,I=void 0!==c&&c,C=e.onSerialize,y=e.onIframeLoad,c=e.iframeLoadTimeout,S=void 0===c?5e3:c,v=e.onStylesheetLoad,c=e.stylesheetLoadTimeout,b=void 0===c?5e3:c,c=e.keepIframeSrcFn,A=void 0===c?function(){return!1}:c,c=e.newlyAddedElement,e=e.preserveWhiteSpace,E=void 0===e||e,e=serializeNode(t,{doc:r,mirror:o,blockClass:n,blockSelector:s,maskTextClass:a,maskTextSelector:i,inlineStylesheet:d,maskInputOptions:u,maskTextFn:p,maskInputFn:g,dataURLOptions:m,inlineImages:f,recordCanvas:I,keepIframeSrcFn:A,newlyAddedElement:void 0!==c&&c});if(!e)return console.warn(t,"not serialized"),null;var c=o.hasNode(t)?o.getId(t):slimDOMExcluded(e,h)||!E&&e.type===NodeType.Text&&!e.isStyle&&!e.textContent.replace(/^\s+|\s+$/gm,"").length?IGNORED_NODE:genId(),w=Object.assign(e,{id:c});if(o.add(t,w),c===IGNORED_NODE)return null;C&&C(t);e=!l;if(w.type===NodeType.Element&&(e=e&&!w.needBlock,delete w.needBlock,c=t.shadowRoot)&&isNativeShadowDom(c)&&(w.isShadowHost=!0),(w.type===NodeType.Document||w.type===NodeType.Element)&&e){h.headWhitespace&&w.type===NodeType.Element&&"head"===w.tagName&&(E=!1);for(var k={doc:r,mirror:o,blockClass:n,blockSelector:s,maskTextClass:a,maskTextSelector:i,skipChild:l,inlineStylesheet:d,maskInputOptions:u,maskTextFn:p,maskInputFn:g,slimDOMOptions:h,dataURLOptions:m,inlineImages:f,recordCanvas:I,preserveWhiteSpace:E,onSerialize:C,onIframeLoad:y,iframeLoadTimeout:S,onStylesheetLoad:v,stylesheetLoadTimeout:b,keepIframeSrcFn:A},T=0,R=Array.from(t.childNodes);T<R.length;T++)(M=serializeNodeWithId(R[T],k))&&w.childNodes.push(M);if(isElement(t)&&t.shadowRoot)for(var M,x=0,N=Array.from(t.shadowRoot.childNodes);x<N.length;x++)(M=serializeNodeWithId(N[x],k))&&(isNativeShadowDom(t.shadowRoot)&&(M.isShadow=!0),w.childNodes.push(M))}return t.parentNode&&isShadowRoot(t.parentNode)&&isNativeShadowDom(t.parentNode)&&(w.isShadow=!0),w.type===NodeType.Element&&"iframe"===w.tagName&&onceIframeLoaded(t,function(){var e=t.contentDocument;e&&y&&(e=serializeNodeWithId(e,{doc:e,mirror:o,blockClass:n,blockSelector:s,maskTextClass:a,maskTextSelector:i,skipChild:!1,inlineStylesheet:d,maskInputOptions:u,maskTextFn:p,maskInputFn:g,slimDOMOptions:h,dataURLOptions:m,inlineImages:f,recordCanvas:I,preserveWhiteSpace:E,onSerialize:C,onIframeLoad:y,iframeLoadTimeout:S,onStylesheetLoad:v,stylesheetLoadTimeout:b,keepIframeSrcFn:A}))&&y(t,e)},S),w.type===NodeType.Element&&"link"===w.tagName&&"stylesheet"===w.attributes.rel&&onceStylesheetLoaded(t,function(){var e;v&&(e=serializeNodeWithId(t,{doc:r,mirror:o,blockClass:n,blockSelector:s,maskTextClass:a,maskTextSelector:i,skipChild:!1,inlineStylesheet:d,maskInputOptions:u,maskTextFn:p,maskInputFn:g,slimDOMOptions:h,dataURLOptions:m,inlineImages:f,recordCanvas:I,preserveWhiteSpace:E,onSerialize:C,onIframeLoad:y,iframeLoadTimeout:S,onStylesheetLoad:v,stylesheetLoadTimeout:b,keepIframeSrcFn:A}))&&v(t,e)},b),w}function snapshot(e,t){var t=t||{},r=t.mirror,r=void 0===r?new Mirror:r,o=t.blockClass,n=t.blockSelector,s=t.maskTextClass,a=t.maskTextSelector,i=t.inlineStylesheet,l=t.inlineImages,c=t.recordCanvas,d=t.maskAllInputs,d=void 0!==d&&d,u=t.slimDOM,u=void 0!==u&&u,p=t.keepIframeSrcFn;return serializeNodeWithId(e,{doc:e,mirror:r,blockClass:void 0===o?"rr-block":o,blockSelector:void 0===n?null:n,maskTextClass:void 0===s?"rr-mask":s,maskTextSelector:void 0===a?null:a,skipChild:!1,inlineStylesheet:void 0===i||i,maskInputOptions:!0===d?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===d?{password:!0}:d,maskTextFn:t.maskTextFn,maskInputFn:t.maskInputFn,slimDOMOptions:!0===u||"all"===u?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===u,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===u?{}:u,dataURLOptions:t.dataURLOptions,inlineImages:void 0!==l&&l,recordCanvas:void 0!==c&&c,preserveWhiteSpace:t.preserveWhiteSpace,onSerialize:t.onSerialize,onIframeLoad:t.onIframeLoad,iframeLoadTimeout:t.iframeLoadTimeout,onStylesheetLoad:t.onStylesheetLoad,stylesheetLoadTimeout:t.stylesheetLoadTimeout,keepIframeSrcFn:void 0===p?function(){return!1}:p,newlyAddedElement:!1})}function on(e,t,r=document){let o={capture:!0,passive:!0};return r.addEventListener(e,t,o),()=>r.removeEventListener(e,t,o)}let DEPARTED_MIRROR_ACCESS_WARNING="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.",_mirror={map:{},getId(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),-1},getNode(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),null},removeNodeFromMap(){console.error(DEPARTED_MIRROR_ACCESS_WARNING)},has(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),!1},reset(){console.error(DEPARTED_MIRROR_ACCESS_WARNING)}};function throttle(n,s,a={}){let i=null,l=0;return function(...e){var t=Date.now(),r=(l||!1!==a.leading||(l=t),s-(t-l));let o=this;r<=0||s<r?(i&&(clearTimeout(i),i=null),l=t,n.apply(o,e)):i||!1===a.trailing||(i=setTimeout(()=>{l=!1===a.leading?0:Date.now(),i=null,n.apply(o,e)},r))}}function hookSetter(e,t,r,o,n=window){let s=n.Object.getOwnPropertyDescriptor(e,t);return n.Object.defineProperty(e,t,o?r:{set(e){setTimeout(()=>{r.set.call(this,e)},0),s&&s.set&&s.set.call(this,e)}}),()=>hookSetter(e,t,s||{},!0)}function patch(t,r,o){try{if(!(r in t))return()=>{};let e=t[r];var n=o(e);return"function"==typeof n&&(n.prototype=n.prototype||{},Object.defineProperties(n,{__rrweb_original__:{enumerable:!1,value:e}})),t[r]=n,()=>{t[r]=e}}catch(e){return()=>{}}}function getWindowHeight(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function getWindowWidth(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function isBlocked(e,t,r,o){if(e){var n=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(n){if("string"==typeof t){if(n.classList.contains(t))return!0;if(o&&null!==n.closest("."+t))return!0}else if(classMatchesRegex(n,t,o))return!0;if(r){if(e.matches(r))return!0;if(o&&null!==n.closest(r))return!0}}}return!1}function isSerialized(e,t){return-1!==t.getId(e)}function isIgnored(e,t){return t.getId(e)===IGNORED_NODE}function isAncestorRemoved(e,t){var r;return!isShadowRoot(e)&&(r=t.getId(e),!t.has(r)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||isAncestorRemoved(e.parentNode,t)))}function isTouchEvent(e){return Boolean(e.changedTouches)}function polyfill(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let t=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do{if(this===t)return!0}while(t=t&&t.parentNode);return!1})}function isSerializedIframe(e,t){return Boolean("IFRAME"===e.nodeName&&t.getMeta(e))}function isSerializedStylesheet(e,t){return Boolean("LINK"===e.nodeName&&e.nodeType===e.ELEMENT_NODE&&e.getAttribute&&"stylesheet"===e.getAttribute("rel")&&t.getMeta(e))}function hasShadowRoot(e){return Boolean(null==e?void 0:e.shadowRoot)}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(_mirror=new Proxy(_mirror,{get(e,t,r){return"map"===t&&console.error(DEPARTED_MIRROR_ACCESS_WARNING),Reflect.get(e,t,r)}}));class StyleSheetMirror{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(e){return null!=(e=this.styleIDMap.get(e))?e:-1}has(e){return this.styleIDMap.has(e)}add(e,t){if(this.has(e))return this.getId(e);let r;return r=void 0===t?this.id++:t,this.styleIDMap.set(e,r),this.idStyleMap.set(r,e),r}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}var EventType=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(EventType||{}),IncrementalSource=(e=>(e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e))(IncrementalSource||{}),MouseInteractions=(e=>(e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e))(MouseInteractions||{}),CanvasContext=(e=>(e[e["2D"]=0]="2D",e[e.WebGL=1]="WebGL",e[e.WebGL2=2]="WebGL2",e))(CanvasContext||{});function isNodeInLinkedList(e){return"__ln"in e}class DoubleLinkedList{constructor(){this.length=0,this.head=null}get(t){if(t>=this.length)throw new Error("Position outside of list range");let r=this.head;for(let e=0;e<t;e++)r=(null==r?void 0:r.next)||null;return r}addNode(e){var t,r={value:e,previous:null,next:null};e.__ln=r,e.previousSibling&&isNodeInLinkedList(e.previousSibling)?(t=e.previousSibling.__ln.next,r.next=t,r.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=r,t&&(t.previous=r)):e.nextSibling&&isNodeInLinkedList(e.nextSibling)&&e.nextSibling.__ln.previous?(t=e.nextSibling.__ln.previous,r.previous=t,r.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=r,t&&(t.next=r)):(this.head&&(this.head.previous=r),r.next=this.head,this.head=r),this.length++}removeNode(e){var t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next&&(t.next.previous=t.previous)):(this.head=t.next,this.head&&(this.head.previous=null)),e.__ln&&delete e.__ln,this.length--)}}let moveKey=(e,t)=>e+"@"+t;class MutationBuffer{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(!this.frozen&&!this.locked){let d=[],u=new DoubleLinkedList,p=e=>{let t=e,r=IGNORED_NODE;for(;r===IGNORED_NODE;)t=t&&t.nextSibling,r=t&&this.mirror.getId(t);return r};for(var t,r,o,n,s=t=>{let e,r,o,n,s=null,a=s=(null==(r=null==(e=t.getRootNode)?void 0:e.call(t))?void 0:r.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&t.getRootNode().host?t.getRootNode().host:s;for(;(null==(n=null==(o=null==a?void 0:a.getRootNode)?void 0:o.call(a))?void 0:n.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&a.getRootNode().host;)a=a.getRootNode().host;var i,l,c=!(this.doc.contains(t)||a&&this.doc.contains(a));if(t.parentNode&&!c)return c=isShadowRoot(t.parentNode)?this.mirror.getId(s):this.mirror.getId(t.parentNode),i=p(t),-1===c||-1===i?u.addNode(t):void((l=serializeNodeWithId(t,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:e=>{isSerializedIframe(e,this.mirror)&&this.iframeManager.addIframe(e),isSerializedStylesheet(e,this.mirror)&&this.stylesheetManager.trackLinkElement(e),hasShadowRoot(t)&&this.shadowDomManager.addShadowRoot(t.shadowRoot,this.doc)},onIframeLoad:(e,t)=>{this.iframeManager.attachIframe(e,t),this.shadowDomManager.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{this.stylesheetManager.attachLinkElement(e,t)}}))&&d.push({parentId:c,nextId:i,node:l}))};this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(t of Array.from(this.movedSet.values()))isParentRemoved(this.removes,t,this.mirror)&&!this.movedSet.has(t.parentNode)||s(t);for(r of Array.from(this.addedSet.values()))!isAncestorInSet(this.droppedSet,r)&&!isParentRemoved(this.removes,r,this.mirror)||isAncestorInSet(this.movedSet,r)?s(r):this.droppedSet.add(r);let e=null;for(;u.length;){let t=null;if(!(t=e&&(o=this.mirror.getId(e.value.parentNode),n=p(e.value),-1!==o)&&-1!==n?e:t))for(let e=u.length-1;0<=e;e--){var a=u.get(e);if(a){var i=this.mirror.getId(a.value.parentNode),l=p(a.value);if(-1!==l){if(-1!==i){t=a;break}l=a.value;if(l.parentNode&&l.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){i=l.parentNode.host;if(-1!==this.mirror.getId(i)){t=a;break}}}}}if(!t){for(;u.head;)u.removeNode(u.head.value);break}e=t.previous,u.removeNode(t.value),s(t.value)}var c={texts:this.texts.map(e=>({id:this.mirror.getId(e.node),value:e.value})).filter(e=>this.mirror.has(e.id)),attributes:this.attributes.map(e=>({id:this.mirror.getId(e.node),attributes:e.attributes})).filter(e=>this.mirror.has(e.id)),removes:this.removes,adds:d};(c.texts.length||c.attributes.length||c.removes.length||c.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(c))}},this.processMutation=o=>{if(!isIgnored(o.target,this.mirror))switch(o.type){case"characterData":var e=o.target.textContent;isBlocked(o.target,this.blockClass,this.blockSelector,!1)||e===o.oldValue||this.texts.push({value:needMaskingText(o.target,this.maskTextClass,this.maskTextSelector)&&e?this.maskTextFn?this.maskTextFn(e):e.replace(/[\S]/g,"*"):e,node:o.target});break;case"attributes":{var r=o.target;let e=o.target.getAttribute(o.attributeName);if("value"===o.attributeName&&(e=maskInputValue({maskInputOptions:this.maskInputOptions,tagName:o.target.tagName,type:o.target.getAttribute("type"),value:e,maskInputFn:this.maskInputFn})),isBlocked(o.target,this.blockClass,this.blockSelector,!1)||e===o.oldValue)return;let t=this.attributes.find(e=>e.node===o.target);if("IFRAME"===r.tagName&&"src"===o.attributeName&&!this.keepIframeSrcFn(e)){if(r.contentDocument)return;o.attributeName="rr_src"}if(t||(t={node:o.target,attributes:{}},this.attributes.push(t)),"style"===o.attributeName){var n,s,a=this.doc.createElement("span"),i=(o.oldValue&&a.setAttribute("style",o.oldValue),null==t.attributes.style&&(t.attributes.style={}),t.attributes.style);for(n of Array.from(r.style)){var l=r.style.getPropertyValue(n),c=r.style.getPropertyPriority(n);l===a.style.getPropertyValue(n)&&c===a.style.getPropertyPriority(n)||(i[n]=""===c?l:[l,c])}for(s of Array.from(a.style))""===r.style.getPropertyValue(s)&&(i[s]=!1)}else t.attributes[o.attributeName]=transformAttribute(this.doc,r.tagName,o.attributeName,e);break}case"childList":isBlocked(o.target,this.blockClass,this.blockSelector,!0)||(o.addedNodes.forEach(e=>this.genAdds(e,o.target)),o.removedNodes.forEach(e=>{var t=this.mirror.getId(e),r=isShadowRoot(o.target)?this.mirror.getId(o.target.host):this.mirror.getId(o.target);isBlocked(o.target,this.blockClass,this.blockSelector,!1)||isIgnored(e,this.mirror)||!isSerialized(e,this.mirror)||(this.addedSet.has(e)?(deepDelete(this.addedSet,e),this.droppedSet.add(e)):this.addedSet.has(o.target)&&-1===t||isAncestorRemoved(o.target,this.mirror)||(this.movedSet.has(e)&&this.movedMap[moveKey(t,r)]?deepDelete(this.movedSet,e):this.removes.push({parentId:r,id:t,isShadow:!(!isShadowRoot(o.target)||!isNativeShadowDom(o.target))||void 0})),this.mapRemoves.push(e))}))}},this.genAdds=(t,r)=>{if(this.mirror.hasNode(t)){if(isIgnored(t,this.mirror))return;this.movedSet.add(t);let e=null;(e=r&&this.mirror.hasNode(r)?this.mirror.getId(r):e)&&-1!==e&&(this.movedMap[moveKey(this.mirror.getId(t),e)]=!0)}else this.addedSet.add(t),this.droppedSet.delete(t);isBlocked(t,this.blockClass,this.blockSelector,!1)||t.childNodes.forEach(e=>this.genAdds(e))}}init(t){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager"].forEach(e=>{this[e]=t[e]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function deepDelete(t,e){t.delete(e),e.childNodes.forEach(e=>deepDelete(t,e))}function isParentRemoved(e,t,r){return 0!==e.length&&_isParentRemoved(e,t,r)}function _isParentRemoved(e,t,r){t=t.parentNode;if(!t)return!1;let o=r.getId(t);return!!e.some(e=>e.id===o)||_isParentRemoved(e,t,r)}function isAncestorInSet(e,t){return 0!==e.size&&_isAncestorInSet(e,t)}function _isAncestorInSet(e,t){t=t.parentNode;return!!t&&(!!e.has(t)||_isAncestorInSet(e,t))}let mutationBuffers=[],isCSSGroupingRuleSupported="undefined"!=typeof CSSGroupingRule,isCSSMediaRuleSupported="undefined"!=typeof CSSMediaRule,isCSSSupportsRuleSupported="undefined"!=typeof CSSSupportsRule,isCSSConditionRuleSupported="undefined"!=typeof CSSConditionRule;function getEventTarget(t){try{if("composedPath"in t){var e=t.composedPath();if(e.length)return e[0]}else if("path"in t&&t.path.length)return t.path[0];return t.target}catch(e){return t.target}}function initMutationObserver(e,t){var r=new MutationBuffer;mutationBuffers.push(r),r.init(e);let o=window.MutationObserver||window.__rrMutationObserver;var n=null==(n=null==(e=null==window?void 0:window.Zone)?void 0:e.__symbol__)?void 0:n.call(e,"MutationObserver"),e=new(o=n&&window[n]?window[n]:o)(r.processMutations.bind(r));return e.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),e}function initMoveObserver({mousemoveCb:r,sampling:e,doc:t,mirror:n}){if(!1===e.mousemove)return()=>{};var o="number"==typeof e.mousemove?e.mousemove:50,e="number"==typeof e.mousemoveCallback?e.mousemoveCallback:500;let s=[],a,i=throttle(e=>{let t=Date.now()-a;r(s.map(e=>(e.timeOffset-=t,e)),e),s=[],a=null},e);e=throttle(e=>{var t=getEventTarget(e),{clientX:r,clientY:o}=isTouchEvent(e)?e.changedTouches[0]:e;a=a||Date.now(),s.push({x:r,y:o,id:n.getId(t),timeOffset:Date.now()-a}),i("undefined"!=typeof DragEvent&&e instanceof DragEvent?IncrementalSource.Drag:e instanceof MouseEvent?IncrementalSource.MouseMove:IncrementalSource.TouchMove)},o,{trailing:!1});let l=[on("mousemove",e,t),on("touchmove",e,t),on("drag",e,t)];return()=>{l.forEach(e=>e())}}function initMouseInteractionObserver({mouseInteractionCb:n,doc:r,mirror:s,blockClass:a,blockSelector:i,sampling:e}){if(!1===e.mouseInteraction)return()=>{};let t=!0===e.mouseInteraction||void 0===e.mouseInteraction?{}:e.mouseInteraction,l=[];return Object.keys(MouseInteractions).filter(e=>Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==t[e]).forEach(e=>{var o,t=e.toLowerCase(),e=(o=e,e=>{var t,r=getEventTarget(e);isBlocked(r,a,i,!0)||(e=isTouchEvent(e)?e.changedTouches[0]:e)&&(r=s.getId(r),{clientX:e,clientY:t}=e,n({type:MouseInteractions[o],id:r,x:e,y:t}))});l.push(on(t,e,r))}),()=>{l.forEach(e=>e())}}function initScrollObserver({scrollCb:o,doc:n,mirror:s,blockClass:a,blockSelector:i,sampling:e}){return on("scroll",throttle(e=>{var t,r,e=getEventTarget(e);e&&!isBlocked(e,a,i,!0)&&(t=s.getId(e),e===n?(r=n.scrollingElement||n.documentElement,o({id:t,x:r.scrollLeft,y:r.scrollTop})):o({id:t,x:e.scrollLeft,y:e.scrollTop}))},e.scroll||100),n)}function initViewportResizeObserver({viewportResizeCb:r}){let o=-1,n=-1;return on("resize",throttle(()=>{var e=getWindowHeight(),t=getWindowWidth();o===e&&n===t||(r({width:Number(t),height:Number(e)}),o=e,n=t)},200),window)}function wrapEventWithUserTriggeredFlag(e,t){e=Object.assign({},e);return t||delete e.userTriggered,e}let INPUT_TAGS=["INPUT","TEXTAREA","SELECT"],lastInputValueMap=new WeakMap;function initInputObserver({inputCb:o,doc:s,mirror:n,blockClass:e,blockSelector:t,ignoreClass:a,maskInputOptions:i,maskInputFn:l,sampling:r,userTriggeredOnInput:c}){function d(r){let o=getEventTarget(r);r=r.isTrusted;if((o=o&&"OPTION"===o.tagName?o.parentElement:o)&&o.tagName&&!(INPUT_TAGS.indexOf(o.tagName)<0)&&!isBlocked(o,e,t,!0)){var n=o.type;if(!o.classList.contains(a)){let e=o.value,t=!1;"radio"===n||"checkbox"===n?t=o.checked:(i[o.tagName.toLowerCase()]||i[n])&&(e=maskInputValue({maskInputOptions:i,tagName:o.tagName,type:n,value:e,maskInputFn:l})),u(o,wrapEventWithUserTriggeredFlag({text:e,isChecked:t,userTriggered:r},c));r=o.name;"radio"===n&&r&&t&&s.querySelectorAll(`input[type="radio"][name="${r}"]`).forEach(e=>{e!==o&&u(e,wrapEventWithUserTriggeredFlag({text:e.value,isChecked:!t,userTriggered:!1},c))})}}}function u(e,t){var r=lastInputValueMap.get(e);r&&r.text===t.text&&r.isChecked===t.isChecked||(lastInputValueMap.set(e,t),r=n.getId(e),o(Object.assign(Object.assign({},t),{id:r})))}var p;let g=("last"===r.input?["change"]:["input","change"]).map(e=>on(e,d,s)),h=s.defaultView;return h?(r=h.Object.getOwnPropertyDescriptor(h.HTMLInputElement.prototype,"value"),p=[[h.HTMLInputElement.prototype,"value"],[h.HTMLInputElement.prototype,"checked"],[h.HTMLSelectElement.prototype,"value"],[h.HTMLTextAreaElement.prototype,"value"],[h.HTMLSelectElement.prototype,"selectedIndex"],[h.HTMLOptionElement.prototype,"selected"]],r&&r.set&&g.push(...p.map(e=>hookSetter(e[0],e[1],{set(){d({target:this})}},!1,h))),()=>{g.forEach(e=>e())}):()=>{g.forEach(e=>e())}}function getNestedCSSRulePositions(e){var t,r;return e=e,t=[],isCSSGroupingRuleSupported&&e.parentRule instanceof CSSGroupingRule||isCSSMediaRuleSupported&&e.parentRule instanceof CSSMediaRule||isCSSSupportsRuleSupported&&e.parentRule instanceof CSSSupportsRule||isCSSConditionRuleSupported&&e.parentRule instanceof CSSConditionRule?(r=Array.from(e.parentRule.cssRules).indexOf(e),t.unshift(r)):e.parentStyleSheet&&(r=Array.from(e.parentStyleSheet.cssRules).indexOf(e),t.unshift(r)),t}function getIdAndStyleId(e,t,r){let o,n;return e?(e.ownerNode?o=t.getId(e.ownerNode):n=r.getId(e),{styleId:n,id:o}):{}}function initStyleSheetObserver({styleSheetRuleCb:s,mirror:a,stylesheetManager:i},{win:e}){let n=e.CSSStyleSheet.prototype.insertRule,o=(e.CSSStyleSheet.prototype.insertRule=function(e,t){var{id:r,styleId:o}=getIdAndStyleId(this,a,i.styleMirror);return(r&&-1!==r||o&&-1!==o)&&s({id:r,styleId:o,adds:[{rule:e,index:t}]}),n.apply(this,[e,t])},e.CSSStyleSheet.prototype.deleteRule);e.CSSStyleSheet.prototype.deleteRule=function(e){var{id:t,styleId:r}=getIdAndStyleId(this,a,i.styleMirror);return(t&&-1!==t||r&&-1!==r)&&s({id:t,styleId:r,removes:[{index:e}]}),o.apply(this,[e])};let l;e.CSSStyleSheet.prototype.replace&&(l=e.CSSStyleSheet.prototype.replace,e.CSSStyleSheet.prototype.replace=function(e){var{id:t,styleId:r}=getIdAndStyleId(this,a,i.styleMirror);return(t&&-1!==t||r&&-1!==r)&&s({id:t,styleId:r,replace:e}),l.apply(this,[e])});let c,t=(e.CSSStyleSheet.prototype.replaceSync&&(c=e.CSSStyleSheet.prototype.replaceSync,e.CSSStyleSheet.prototype.replaceSync=function(e){var{id:t,styleId:r}=getIdAndStyleId(this,a,i.styleMirror);return(t&&-1!==t||r&&-1!==r)&&s({id:t,styleId:r,replaceSync:e}),c.apply(this,[e])}),{}),d=(isCSSGroupingRuleSupported?t.CSSGroupingRule=e.CSSGroupingRule:(isCSSMediaRuleSupported&&(t.CSSMediaRule=e.CSSMediaRule),isCSSConditionRuleSupported&&(t.CSSConditionRule=e.CSSConditionRule),isCSSSupportsRuleSupported&&(t.CSSSupportsRule=e.CSSSupportsRule)),{});return Object.entries(t).forEach(([n,e])=>{d[n]={insertRule:e.prototype.insertRule,deleteRule:e.prototype.deleteRule},e.prototype.insertRule=function(e,t){var{id:r,styleId:o}=getIdAndStyleId(this.parentStyleSheet,a,i.styleMirror);return(r&&-1!==r||o&&-1!==o)&&s({id:r,styleId:o,adds:[{rule:e,index:[...getNestedCSSRulePositions(this),t||0]}]}),d[n].insertRule.apply(this,[e,t])},e.prototype.deleteRule=function(e){var{id:t,styleId:r}=getIdAndStyleId(this.parentStyleSheet,a,i.styleMirror);return(t&&-1!==t||r&&-1!==r)&&s({id:t,styleId:r,removes:[{index:[...getNestedCSSRulePositions(this),e]}]}),d[n].deleteRule.apply(this,[e])}}),()=>{e.CSSStyleSheet.prototype.insertRule=n,e.CSSStyleSheet.prototype.deleteRule=o,l&&(e.CSSStyleSheet.prototype.replace=l),c&&(e.CSSStyleSheet.prototype.replaceSync=c),Object.entries(t).forEach(([e,t])=>{t.prototype.insertRule=d[e].insertRule,t.prototype.deleteRule=d[e].deleteRule})}}function initAdoptedStyleSheetObserver({mirror:e,stylesheetManager:r},t){let o,n,s,a=null;a="#document"===t.nodeName?e.getId(t):e.getId(t.host);e="#document"===t.nodeName?null==(o=t.defaultView)?void 0:o.Document:null==(s=null==(n=t.ownerDocument)?void 0:n.defaultView)?void 0:s.ShadowRoot;let i=Object.getOwnPropertyDescriptor(null==e?void 0:e.prototype,"adoptedStyleSheets");return null!==a&&-1!==a&&e&&i?(Object.defineProperty(t,"adoptedStyleSheets",{configurable:i.configurable,enumerable:i.enumerable,get(){var e;return null==(e=i.get)?void 0:e.call(this)},set(e){var t=null==(t=i.set)?void 0:t.call(this,e);if(null!==a&&-1!==a)try{r.adoptStyleSheets(e,a)}catch(e){}return t}}),()=>{Object.defineProperty(t,"adoptedStyleSheets",{configurable:i.configurable,enumerable:i.enumerable,get:i.get,set:i.set})}):()=>{}}function initStyleDeclarationObserver({styleDeclarationCb:s,mirror:a,ignoreCSSAttributes:i,stylesheetManager:l},{win:e}){let c=e.CSSStyleDeclaration.prototype.setProperty,o=(e.CSSStyleDeclaration.prototype.setProperty=function(e,t,r){var o,n;return!i.has(e)&&({id:o,styleId:n}=getIdAndStyleId(null==(o=this.parentRule)?void 0:o.parentStyleSheet,a,l.styleMirror),o&&-1!==o||n&&-1!==n)&&s({id:o,styleId:n,set:{property:e,value:t,priority:r},index:getNestedCSSRulePositions(this.parentRule)}),c.apply(this,[e,t,r])},e.CSSStyleDeclaration.prototype.removeProperty);return e.CSSStyleDeclaration.prototype.removeProperty=function(e){var t,r;return!i.has(e)&&({id:t,styleId:r}=getIdAndStyleId(null==(t=this.parentRule)?void 0:t.parentStyleSheet,a,l.styleMirror),t&&-1!==t||r&&-1!==r)&&s({id:t,styleId:r,remove:{property:e},index:getNestedCSSRulePositions(this.parentRule)}),o.apply(this,[e])},()=>{e.CSSStyleDeclaration.prototype.setProperty=c,e.CSSStyleDeclaration.prototype.removeProperty=o}}function initMediaInteractionObserver({mediaInteractionCb:a,blockClass:i,blockSelector:l,mirror:c,sampling:e}){var t=s=>throttle(e=>{var t,r,o,n,e=getEventTarget(e);e&&!isBlocked(e,i,l,!0)&&({currentTime:t,volume:r,muted:o,playbackRate:n}=e,a({type:s,id:c.getId(e),currentTime:t,volume:r,muted:o,playbackRate:n}))},e.media||500);let r=[on("play",t(0)),on("pause",t(1)),on("seeked",t(2)),on("volumechange",t(3)),on("ratechange",t(4))];return()=>{r.forEach(e=>e())}}function initFontObserver({fontCb:r,doc:e}){let t=e.defaultView;if(!t)return()=>{};let o=[],n=new WeakMap,s=t.FontFace;t.FontFace=function(e,t,r){var o=new s(e,t,r);return n.set(o,{family:e,buffer:"string"!=typeof t,descriptors:r,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),o};e=patch(e.fonts,"add",function(e){return function(t){return setTimeout(()=>{var e=n.get(t);e&&(r(e),n.delete(t))},0),e.apply(this,[t])}});return o.push(()=>{t.FontFace=s}),o.push(e),()=>{o.forEach(e=>e())}}function initSelectionObserver(e){let{doc:l,mirror:c,blockClass:d,blockSelector:u,selectionCb:p}=e,g=!0;e=()=>{var t=l.getSelection();if(!(!t||g&&null!=t&&t.isCollapsed)){g=t.isCollapsed||!1;var r=[],o=t.rangeCount||0;for(let e=0;e<o;e++){var{startContainer:n,startOffset:s,endContainer:a,endOffset:i}=t.getRangeAt(e);isBlocked(n,d,u,!0)||isBlocked(a,d,u,!0)||r.push({start:c.getId(n),startOffset:s,end:c.getId(a),endOffset:i})}p({ranges:r})}};return e(),on("selectionchange",e)}function mergeHooks(e,t){let{mutationCb:r,mousemoveCb:o,mouseInteractionCb:n,scrollCb:s,viewportResizeCb:a,inputCb:i,mediaInteractionCb:l,styleSheetRuleCb:c,styleDeclarationCb:d,canvasMutationCb:u,fontCb:p,selectionCb:g}=e;e.mutationCb=(...e)=>{t.mutation&&t.mutation(...e),r(...e)},e.mousemoveCb=(...e)=>{t.mousemove&&t.mousemove(...e),o(...e)},e.mouseInteractionCb=(...e)=>{t.mouseInteraction&&t.mouseInteraction(...e),n(...e)},e.scrollCb=(...e)=>{t.scroll&&t.scroll(...e),s(...e)},e.viewportResizeCb=(...e)=>{t.viewportResize&&t.viewportResize(...e),a(...e)},e.inputCb=(...e)=>{t.input&&t.input(...e),i(...e)},e.mediaInteractionCb=(...e)=>{t.mediaInteaction&&t.mediaInteaction(...e),l(...e)},e.styleSheetRuleCb=(...e)=>{t.styleSheetRule&&t.styleSheetRule(...e),c(...e)},e.styleDeclarationCb=(...e)=>{t.styleDeclaration&&t.styleDeclaration(...e),d(...e)},e.canvasMutationCb=(...e)=>{t.canvasMutation&&t.canvasMutation(...e),u(...e)},e.fontCb=(...e)=>{t.font&&t.font(...e),p(...e)},e.selectionCb=(...e)=>{t.selection&&t.selection(...e),g(...e)}}function initObservers(e,t={}){var r,o=e.doc.defaultView;if(!o)return()=>{};mergeHooks(e,t);let n=initMutationObserver(e,e.doc),s=initMoveObserver(e),a=initMouseInteractionObserver(e),i=initScrollObserver(e),l=initViewportResizeObserver(e),c=initInputObserver(e),d=initMediaInteractionObserver(e),u=initStyleSheetObserver(e,{win:o}),p=initAdoptedStyleSheetObserver(e,e.doc),g=initStyleDeclarationObserver(e,{win:o}),h=e.collectFonts?initFontObserver(e):()=>{},m=initSelectionObserver(e),f=[];for(r of e.plugins)f.push(r.observer(r.callback,o,r.options));return()=>{mutationBuffers.forEach(e=>e.reset()),n.disconnect(),s(),a(),i(),l(),c(),d(),u(),p(),g(),h(),m(),f.forEach(e=>e())}}class CrossOriginIframeMirror{constructor(e){this.generateIdFn=e,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(e,t,r,o){r=r||this.getIdToRemoteIdMap(e),o=o||this.getRemoteIdToIdMap(e);let n=r.get(t);return n||(n=this.generateIdFn(),r.set(t,n),o.set(n,t)),n}getIds(t,e){let r=this.getIdToRemoteIdMap(t),o=this.getRemoteIdToIdMap(t);return e.map(e=>this.getId(t,e,r,o))}getRemoteId(e,t,r){r=r||this.getRemoteIdToIdMap(e);return"number"!=typeof t?t:r.get(t)||-1}getRemoteIds(t,e){let r=this.getRemoteIdToIdMap(t);return e.map(e=>this.getRemoteId(t,e,r))}reset(e){e?(this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)):(this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap)}getIdToRemoteIdMap(e){let t=this.iframeIdToRemoteIdMap.get(e);return t||(t=new Map,this.iframeIdToRemoteIdMap.set(e,t)),t}getRemoteIdToIdMap(e){let t=this.iframeRemoteIdToIdMap.get(e);return t||(t=new Map,this.iframeRemoteIdToIdMap.set(e,t)),t}}class IframeManager{constructor(e){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new CrossOriginIframeMirror(genId),this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new CrossOriginIframeMirror(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null!=(t=this.loadListener)&&t.call(this,e),e.contentDocument&&e.contentDocument.adoptedStyleSheets&&0<e.contentDocument.adoptedStyleSheets.length&&this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets,this.mirror.getId(e.contentDocument))}handleMessage(e){var t;"rrweb"===e.data.type&&e.source&&(t=this.crossOriginIframeMap.get(e.source))&&(t=this.transformCrossOriginEvent(t,e.data.event))&&this.wrappedEmit(t,e.data.isCheckout)}transformCrossOriginEvent(t,e){var r;switch(e.type){case EventType.FullSnapshot:return this.crossOriginIframeMirror.reset(t),this.crossOriginIframeStyleMirror.reset(t),this.replaceIdOnNode(e.data.node,t),{timestamp:e.timestamp,type:EventType.IncrementalSnapshot,data:{source:IncrementalSource.Mutation,adds:[{parentId:this.mirror.getId(t),nextId:null,node:e.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}};case EventType.Meta:case EventType.Load:case EventType.DomContentLoaded:return!1;case EventType.Plugin:return e;case EventType.Custom:return this.replaceIds(e.data.payload,t,["id","parentId","previousId","nextId"]),e;case EventType.IncrementalSnapshot:switch(e.data.source){case IncrementalSource.Mutation:return e.data.adds.forEach(e=>{this.replaceIds(e,t,["parentId","nextId","previousId"]),this.replaceIdOnNode(e.node,t)}),e.data.removes.forEach(e=>{this.replaceIds(e,t,["parentId","id"])}),e.data.attributes.forEach(e=>{this.replaceIds(e,t,["id"])}),e.data.texts.forEach(e=>{this.replaceIds(e,t,["id"])}),e;case IncrementalSource.Drag:case IncrementalSource.TouchMove:case IncrementalSource.MouseMove:return e.data.positions.forEach(e=>{this.replaceIds(e,t,["id"])}),e;case IncrementalSource.ViewportResize:return!1;case IncrementalSource.MediaInteraction:case IncrementalSource.MouseInteraction:case IncrementalSource.Scroll:case IncrementalSource.CanvasMutation:case IncrementalSource.Input:return this.replaceIds(e.data,t,["id"]),e;case IncrementalSource.StyleSheetRule:case IncrementalSource.StyleDeclaration:return this.replaceIds(e.data,t,["id"]),this.replaceStyleIds(e.data,t,["styleId"]),e;case IncrementalSource.Font:return e;case IncrementalSource.Selection:return e.data.ranges.forEach(e=>{this.replaceIds(e,t,["start","end"])}),e;case IncrementalSource.AdoptedStyleSheet:return this.replaceIds(e.data,t,["id"]),this.replaceStyleIds(e.data,t,["styleIds"]),null!=(r=e.data.styles)&&r.forEach(e=>{this.replaceStyleIds(e,t,["styleId"])}),e}}}replace(e,t,r,o){for(var n of o)!Array.isArray(t[n])&&"number"!=typeof t[n]||(Array.isArray(t[n])?t[n]=e.getIds(r,t[n]):t[n]=e.getId(r,t[n]));return t}replaceIds(e,t,r){return this.replace(this.crossOriginIframeMirror,e,t,r)}replaceStyleIds(e,t,r){return this.replace(this.crossOriginIframeStyleMirror,e,t,r)}replaceIdOnNode(e,t){this.replaceIds(e,t,["id"]),"childNodes"in e&&e.childNodes.forEach(e=>{this.replaceIdOnNode(e,t)})}}class ShadowDomManager{constructor(e){this.shadowDoms=new WeakSet,this.restorePatches=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror;let r=this;this.restorePatches.push(patch(Element.prototype,"attachShadow",function(t){return function(e){e=t.call(this,e);return this.shadowRoot&&r.addShadowRoot(this.shadowRoot,this.ownerDocument),e}}))}addShadowRoot(e,t){!isNativeShadowDom(e)||this.shadowDoms.has(e)||(this.shadowDoms.add(e),initMutationObserver(Object.assign(Object.assign({},this.bypassOptions),{doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),e),initScrollObserver(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:e,mirror:this.mirror})),setTimeout(()=>{e.adoptedStyleSheets&&0<e.adoptedStyleSheets.length&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),initAdoptedStyleSheetObserver({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e)},0))}observeAttachShadow(o){if(o.contentWindow){let r=this;this.restorePatches.push(patch(o.contentWindow.HTMLElement.prototype,"attachShadow",function(t){return function(e){e=t.call(this,e);return this.shadowRoot&&r.addShadowRoot(this.shadowRoot,o.contentDocument),e}}))}}reset(){this.restorePatches.forEach(e=>e()),this.shadowDoms=new WeakSet}}function __rest(e,t){var r={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}function __awaiter(e,t,a,i){return new(a=a||Promise)(function(r,t){function o(e){try{s(i.next(e))}catch(e){t(e)}}function n(e){try{s(i.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(o,n)}s((i=i.apply(e,[])).next())})}for(var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i=0;i<chars.length;i++)lookup[chars.charCodeAt(i)]=i;var encode=function(e){for(var t=new Uint8Array(e),r=t.length,o="",n=0;n<r;n+=3)o=(o=(o=(o+=chars[t[n]>>2])+chars[(3&t[n])<<4|t[n+1]>>4])+chars[(15&t[n+1])<<2|t[n+2]>>6])+chars[63&t[n+2]];return r%3==2?o=o.substring(0,o.length-1)+"=":r%3==1&&(o=o.substring(0,o.length-2)+"=="),o};let canvasVarMap=new Map;function variableListFor(e,t){let r=canvasVarMap.get(e);return r||(r=new Map,canvasVarMap.set(e,r)),r.has(t)||r.set(t,[]),r.get(t)}let saveWebGLVar=(t,r,o)=>{if(t&&(isInstanceOfWebGLObject(t,r)||"object"==typeof t)){r=variableListFor(o,t.constructor.name);let e=r.indexOf(t);return-1===e&&(e=r.length,r.push(t)),e}};function serializeArg(e,t,r){var o;return e instanceof Array?e.map(e=>serializeArg(e,t,r)):null===e?e:e instanceof Float32Array||e instanceof Float64Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Int8Array||e instanceof Uint8ClampedArray?{rr_type:e.constructor.name,args:[Object.values(e)]}:e instanceof ArrayBuffer?{rr_type:e.constructor.name,base64:encode(e)}:e instanceof DataView?{rr_type:e.constructor.name,args:[serializeArg(e.buffer,t,r),e.byteOffset,e.byteLength]}:e instanceof HTMLImageElement?(o=e.src,{rr_type:e.constructor.name,src:o}):e instanceof HTMLCanvasElement?{rr_type:"HTMLImageElement",src:e.toDataURL()}:e instanceof ImageData?{rr_type:e.constructor.name,args:[serializeArg(e.data,t,r),e.width,e.height]}:isInstanceOfWebGLObject(e,t)||"object"==typeof e?{rr_type:e.constructor.name,index:saveWebGLVar(e,t,r)}:e}let serializeArgs=(e,t,r)=>[...e].map(e=>serializeArg(e,t,r)),isInstanceOfWebGLObject=(t,r)=>{var e=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(e=>"function"==typeof r[e]);return Boolean(e.find(e=>t instanceof r[e]))};function initCanvas2DMutationObserver(o,n,s,a){let t=[];var e;for(let r of Object.getOwnPropertyNames(n.CanvasRenderingContext2D.prototype))try{"function"==typeof n.CanvasRenderingContext2D.prototype[r]&&(e=patch(n.CanvasRenderingContext2D.prototype,r,function(e){return function(...t){return isBlocked(this.canvas,s,a,!0)||setTimeout(()=>{var e=serializeArgs([...t],n,this);o(this.canvas,{type:CanvasContext["2D"],property:r,args:e})},0),e.apply(this,t)}}),t.push(e))}catch(e){var i=hookSetter(n.CanvasRenderingContext2D.prototype,r,{set(e){o(this.canvas,{type:CanvasContext["2D"],property:r,args:[e],setter:!0})}});t.push(i)}return()=>{t.forEach(e=>e())}}function initCanvasContextObserver(e,o,n){let t=[];try{var r=patch(e.HTMLCanvasElement.prototype,"getContext",function(r){return function(e,...t){return isBlocked(this,o,n,!0)||"__context"in this||(this.__context=e),r.apply(this,[e,...t])}});t.push(r)}catch(e){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{t.forEach(e=>e())}}function patchGLPrototype(t,n,s,a,i,e,l){var r,c=[];for(let o of Object.getOwnPropertyNames(t))if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(o))try{"function"==typeof t[o]&&(r=patch(t,o,function(r){return function(...e){var t=r.apply(this,e);return saveWebGLVar(t,l,this),isBlocked(this.canvas,a,i,!0)||(e=serializeArgs([...e],l,this),e={type:n,property:o,args:e},s(this.canvas,e)),t}}),c.push(r))}catch(e){var d=hookSetter(t,o,{set(e){s(this.canvas,{type:n,property:o,args:[e],setter:!0})}});c.push(d)}return c}function initCanvasWebGLMutationObserver(e,t,r,o,n){let s=[];return s.push(...patchGLPrototype(t.WebGLRenderingContext.prototype,CanvasContext.WebGL,e,r,o,n,t)),void 0!==t.WebGL2RenderingContext&&s.push(...patchGLPrototype(t.WebGL2RenderingContext.prototype,CanvasContext.WebGL2,e,r,o,n,t)),()=>{s.forEach(e=>e())}}var WorkerClass=null;try{var WorkerThreads="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads"),WorkerClass=WorkerThreads.Worker}catch(e){}function decodeBase64$1(e,t){return Buffer.from(e,"base64").toString("utf8")}function createBase64WorkerFactory$2(e,t,r){var e=decodeBase64$1(e),o=e.indexOf("\n",10)+1,n=e.substring(o)+"";return function(e){return new WorkerClass(n,Object.assign({},e,{eval:!0}))}}function decodeBase64(e,t){return atob(e)}function createURL(e,t,r){var e=decodeBase64(e),o=e.indexOf("\n",10)+1,e=e.substring(o)+"",o=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(o)}function createBase64WorkerFactory$1(t,e,r){var o;return function(e){return o=o||createURL(t),new Worker(o,e)}}var kIsNodeJS="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);function isNodeJS(){return kIsNodeJS}function createBase64WorkerFactory(e,t,r){return(isNodeJS()?createBase64WorkerFactory$2:createBase64WorkerFactory$1)(e)}var WorkerFactory=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=");class CanvasManager{constructor(e){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(e,t)=>{(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId||!this.rafStamps.invokeId)&&(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(e)||this.pendingCanvasMutations.set(e,[]),this.pendingCanvasMutations.get(e).push(t)};var{sampling:t="all",win:r,blockClass:o,blockSelector:n,recordCanvas:s,dataURLOptions:a}=e;this.mutationCb=e.mutationCb,this.mirror=e.mirror,s&&"all"===t&&this.initCanvasMutationObserver(r,o,n),s&&"number"==typeof t&&this.initCanvasFPSObserver(t,r,o,n,{dataURLOptions:a})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(e,r,o,n,s){let t=initCanvasContextObserver(r,o,n),a=new Map,i=new WorkerFactory,l=(i.onmessage=e=>{var t,r,o,n=e.data.id;a.set(n,!1),"base64"in e.data&&({base64:e,type:t,width:r,height:o}=e.data,this.mutationCb({id:n,type:CanvasContext["2D"],commands:[{property:"clearRect",args:[0,0,r,o]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:e}],type:t}]},0,0]}]}))},1e3/e),c=0,d,u=()=>{let t=[];return r.document.querySelectorAll("canvas").forEach(e=>{isBlocked(e,o,n,!0)||t.push(e)}),t},p=e=>{d=(c&&e-c<l||(c=e,u().forEach(o=>__awaiter(this,void 0,void 0,function*(){var e,t,r=this.mirror.getId(o);a.get(r)||(a.set(r,!0),["webgl","webgl2"].includes(o.__context)&&!1===(null==(t=null==(e=o.getContext(o.__context))?void 0:e.getContextAttributes())?void 0:t.preserveDrawingBuffer)&&null!=e&&e.clear(e.COLOR_BUFFER_BIT),t=yield createImageBitmap(o),i.postMessage({id:r,bitmap:t,width:o.width,height:o.height,dataURLOptions:s.dataURLOptions},[t]))}))),requestAnimationFrame(p))};d=requestAnimationFrame(p),this.resetObservers=()=>{t(),cancelAnimationFrame(d)}}initCanvasMutationObserver(e,t,r){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();let o=initCanvasContextObserver(e,t,r),n=initCanvas2DMutationObserver(this.processMutation.bind(this),e,t,r),s=initCanvasWebGLMutationObserver(this.processMutation.bind(this),e,t,r,this.mirror);this.resetObservers=()=>{o(),n(),s()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){let t=e=>{this.rafStamps.latestId=e,requestAnimationFrame(t)};requestAnimationFrame(t)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((e,t)=>{var r=this.mirror.getId(t);this.flushPendingCanvasMutationFor(t,r)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(e,t){var r,o;this.frozen||this.locked||(o=this.pendingCanvasMutations.get(e))&&-1!==t&&(r=o.map(e=>__rest(e,["type"])),o=o[0].type,this.mutationCb({id:t,type:o,commands:r}),this.pendingCanvasMutations.delete(e))}}class StylesheetManager{constructor(e){this.trackedLinkElements=new WeakSet,this.styleMirror=new StyleSheetMirror,this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,t){"_cssText"in t.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:t.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,t){if(0!==e.length){var r,o,n={id:t,styleIds:[]},s=[];for(r of e){let e;this.styleMirror.has(r)?e=this.styleMirror.getId(r):(e=this.styleMirror.add(r),o=Array.from(r.rules||CSSRule),s.push({styleId:e,rules:o.map((e,t)=>({rule:getCssRuleString(e),index:t}))})),n.styleIds.push(e)}0<s.length&&(n.styles=s),this.adoptedStyleSheetCb(n)}}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}}function wrapEvent(e){return Object.assign(Object.assign({},e),{timestamp:Date.now()})}let wrappedEmit,takeFullSnapshot,canvasManager,recording=!1,mirror=createMirror();function record$1(e={}){let{emit:o,checkoutEveryNms:n,checkoutEveryNth:s,blockClass:a="rr-block",blockSelector:i=null,ignoreClass:B="rr-ignore",maskTextClass:l="rr-mask",maskTextSelector:c=null,inlineStylesheet:d=!0,maskAllInputs:L,maskInputOptions:t,slimDOMOptions:r,maskInputFn:u,maskTextFn:p,hooks:W,packFn:g,sampling:h={},dataURLOptions:m={},mousemoveWait:f,recordCanvas:I=!1,recordCrossOriginIframes:C=!1,userTriggeredOnInput:V=!1,collectFonts:U=!1,inlineImages:y=!1,plugins:S,keepIframeSrcFn:v=()=>!1,ignoreCSSAttributes:G=new Set([])}=e,b=!C||window.parent===window,A=!1;if(!b)try{window.parent.document,A=!1}catch(e){A=!0}if(b&&!o)throw new Error("emit function is required");void 0!==f&&void 0===h.mousemove&&(h.mousemove=f),mirror.reset();let E=!0===L?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==t?t:{password:!0},w=!0===r||"all"===r?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===r,headMetaDescKeywords:"all"===r}:r||{};polyfill();let k,T=0,R=e=>{for(var t of S||[])t.eventProcessor&&(e=t.eventProcessor(e));return e=g?g(e):e},M=(wrappedEmit=(e,t)=>{var r;null==(r=mutationBuffers[0])||!r.isFrozen()||e.type===EventType.FullSnapshot||e.type===EventType.IncrementalSnapshot&&e.data.source===IncrementalSource.Mutation||mutationBuffers.forEach(e=>e.unfreeze()),b?null!=o&&o(R(e),t):A&&(r={type:"rrweb",event:R(e),isCheckout:t},window.parent.postMessage(r,"*")),e.type===EventType.FullSnapshot?(k=e,T=0):e.type!==EventType.IncrementalSnapshot||e.data.source===IncrementalSource.Mutation&&e.data.isAttachIframe||(T++,t=s&&T>=s,r=n&&e.timestamp-k.timestamp>n,(t||r)&&takeFullSnapshot(!0))},e=>{wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.Mutation},e)}))}),x=e=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.Scroll},e)})),N=e=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.CanvasMutation},e)}));var _;let O=new StylesheetManager({mutationCb:M,adoptedStyleSheetCb:e=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.AdoptedStyleSheet},e)}))}),F=new IframeManager({mirror:mirror,mutationCb:M,stylesheetManager:O,recordCrossOriginIframes:C,wrappedEmit:wrappedEmit});for(_ of S||[])_.getMirror&&_.getMirror({nodeMirror:mirror,crossOriginIframeMirror:F.crossOriginIframeMirror,crossOriginIframeStyleMirror:F.crossOriginIframeStyleMirror});canvasManager=new CanvasManager({recordCanvas:I,mutationCb:N,win:window,blockClass:a,blockSelector:i,mirror:mirror,sampling:h.canvas,dataURLOptions:m});let D=new ShadowDomManager({mutationCb:M,scrollCb:x,bypassOptions:{blockClass:a,blockSelector:i,maskTextClass:l,maskTextSelector:c,inlineStylesheet:d,maskInputOptions:E,dataURLOptions:m,maskTextFn:p,maskInputFn:u,recordCanvas:I,inlineImages:y,sampling:h,slimDOMOptions:w,iframeManager:F,stylesheetManager:O,canvasManager:canvasManager,keepIframeSrcFn:v},mirror:mirror});takeFullSnapshot=(e=!1)=>{wrappedEmit(wrapEvent({type:EventType.Meta,data:{href:window.location.href,width:getWindowWidth(),height:getWindowHeight()}}),e),O.reset(),mutationBuffers.forEach(e=>e.lock());var e=snapshot(document,{mirror:mirror,blockClass:a,blockSelector:i,maskTextClass:l,maskTextSelector:c,inlineStylesheet:d,maskAllInputs:E,maskTextFn:p,slimDOM:w,dataURLOptions:m,recordCanvas:I,inlineImages:y,onSerialize:e=>{isSerializedIframe(e,mirror)&&F.addIframe(e),isSerializedStylesheet(e,mirror)&&O.trackLinkElement(e),hasShadowRoot(e)&&D.addShadowRoot(e.shadowRoot,document)},onIframeLoad:(e,t)=>{F.attachIframe(e,t),D.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{O.attachLinkElement(e,t)},keepIframeSrcFn:v});if(!e)return console.warn("Failed to snapshot the document");wrappedEmit(wrapEvent({type:EventType.FullSnapshot,data:{node:e,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null==document?void 0:document.documentElement.scrollLeft)||(null==(e=null==(e=null==document?void 0:document.body)?void 0:e.parentElement)?void 0:e.scrollLeft)||(null==(e=null==document?void 0:document.body)?void 0:e.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null==document?void 0:document.documentElement.scrollTop)||(null==(e=null==(e=null==document?void 0:document.body)?void 0:e.parentElement)?void 0:e.scrollTop)||(null==(e=null==document?void 0:document.body)?void 0:e.scrollTop)||0}}})),mutationBuffers.forEach(e=>e.unlock()),document.adoptedStyleSheets&&0<document.adoptedStyleSheets.length&&O.adoptStyleSheets(document.adoptedStyleSheets,mirror.getId(document))};try{let t=[],r=(t.push(on("DOMContentLoaded",()=>{wrappedEmit(wrapEvent({type:EventType.DomContentLoaded,data:{}}))})),e=>initObservers({mutationCb:M,mousemoveCb:(e,t)=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:{source:t,positions:e}})),mouseInteractionCb:e=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.MouseInteraction},e)})),scrollCb:x,viewportResizeCb:e=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.ViewportResize},e)})),inputCb:e=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.Input},e)})),mediaInteractionCb:e=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.MediaInteraction},e)})),styleSheetRuleCb:e=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.StyleSheetRule},e)})),styleDeclarationCb:e=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.StyleDeclaration},e)})),canvasMutationCb:N,fontCb:e=>wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.Font},e)})),selectionCb:e=>{wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:Object.assign({source:IncrementalSource.Selection},e)}))},blockClass:a,ignoreClass:B,maskTextClass:l,maskTextSelector:c,maskInputOptions:E,inlineStylesheet:d,sampling:h,recordCanvas:I,inlineImages:y,userTriggeredOnInput:V,collectFonts:U,doc:e,maskInputFn:u,maskTextFn:p,keepIframeSrcFn:v,blockSelector:i,slimDOMOptions:w,dataURLOptions:m,mirror:mirror,iframeManager:F,stylesheetManager:O,shadowDomManager:D,canvasManager:canvasManager,ignoreCSSAttributes:G,plugins:(null==(e=null==S?void 0:S.filter(e=>e.observer))?void 0:e.map(t=>({observer:t.observer,options:t.options,callback:e=>wrappedEmit(wrapEvent({type:EventType.Plugin,data:{plugin:t.name,payload:e}}))})))||[]},W)),e=(F.addLoadListener(e=>{t.push(r(e.contentDocument))}),()=>{takeFullSnapshot(),t.push(r(document)),recording=!0});return"interactive"===document.readyState||"complete"===document.readyState?e():t.push(on("load",()=>{wrappedEmit(wrapEvent({type:EventType.Load,data:{}})),e()},window)),()=>{t.forEach(e=>e()),recording=!1}}catch(e){console.warn(e)}}record$1.addCustomEvent=(e,t)=>{if(!recording)throw new Error("please add custom event after start recording");wrappedEmit(wrapEvent({type:EventType.Custom,data:{tag:e,payload:t}}))},record$1.freezePage=()=>{mutationBuffers.forEach(e=>e.freeze())},record$1.takeFullSnapshot=e=>{if(!recording)throw new Error("please take full snapshot after start recording");takeFullSnapshot(e)},record$1.mirror=mirror;let MAX_time=6e4;class RecordScreen{constructor(){this.snapshot=[],this.init()}init(){var e=null!=(e=_support.baseInfo.options.record.time)?e:1e4;this.closeCallback=record$1({emit:(e,t)=>{t&&(this.snapshot=[]),this.snapshot.push(e)},recordCanvas:!0,checkoutEveryNms:e>=MAX_time?MAX_time:e,sampling:{mousemove:!0,scroll:150,media:800,input:"last",mouseInteraction:{MouseUp:!1,MouseDown:!1,Click:!1,ContextMenu:!1,DblClick:!1,Focus:!1,Blur:!1,TouchStart:!1,TouchEnd:!1}}})}close(){var e;null!=(e=this.closeCallback)&&e.call(this),this.closeCallback=void 0}}let record;function initRecord(){_support.baseInfo.options.record&&_support.baseInfo.options.record.open&&(record=new RecordScreen,_support.record=record)}class Exposure{constructor(){this.options={root:null,rootMargin:"0px",threshold:.5},this.observerMap=new WeakMap,this.targetMap=[]}init(t){return new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&sendReport(exports.EVENT_TYPES.EXPOSURE,{time:Date.now(),threshold:t.threshold,message:t.message,el:getErrorElInfo(t.target),snapshot:[]})})},Object.assign(Object.assign({},this.options),{threshold:t.threshold||.5}))}observer(e){(Array.isArray(e)?e:[e]).forEach(r=>{var e=Array.isArray(r.target)?r.target:[r.target];this.observerMap.has(r)||this.observerMap.set(r,this.init(r)),e.forEach(t=>{var e;this.targetMap.find(e=>e.target===t)||(null!=(e=this.observerMap.get(r))&&e.observe(r.target),this.targetMap.push(r))})})}unobserver(e){(Array.isArray(e)?e:[e]).forEach(t=>{var e,r=this.targetMap.find(e=>e.target===t),o=this.targetMap.findIndex(e=>e.target===t);r&&this.observerMap.get(r)&&(null!=(e=this.observerMap.get(r))&&e.unobserve(t),this.observerMap.delete(r),this.targetMap.slice(o,1))})}}let exposure;function initExposure(){_support.baseInfo.options.isExposure&&(exposure=new Exposure,_support.exposure=exposure)}function lestenExposure(e){if(_support.baseInfo.options.isExposure)try{exposure.observer(e)}catch(e){_support.baseInfo.options.isDebug&&logger.error("曝光Api报错",e.message||"")}}function initPv(){_support.baseInfo.options.isPv&&eventBus.on(exports.EVENT_TYPES.PV,e=>{sendReport(exports.EVENT_TYPES.PV,Object.assign(Object.assign({},e),{snapshot:[]}))})}function lestenPv(e){_support.baseInfo.options.isPv&&eventBus.emit(exports.EVENT_TYPES.PV,e)}class Main{constructor(){}init(e){_global.__log_reporting_init__||verifyBase(e)&&(initBaseOptions(e),initPerformance(),initReWrite(),initPushError(),initPv(),initExposure(),initRecord(),_global.__log_reporting_init__=!0)}}let initBaseData={dsn:"",isDebug:!1,isError:!0,isConsoleError:!1,isPerformance:!0,isResource:!1,isXhr:!0,record:{open:!0,time:1e4},encryptMethod:"lz",method:"beacon",isPv:!1},_name=pck.name,_version=pck.version,_author=pck.author,_description=pck.description,main,init=(e=initBaseData)=>{(main=new Main).init(e)};exports._author=_author,exports._description=_description,exports._global=_global,exports._name=_name,exports._support=_support,exports._version=_version,exports.decryptionFun=decryptionFun,exports.encryptFun=encryptFun,exports.getNavigator=getNavigator,exports.init=init,exports.lestenExposure=lestenExposure,exports.lestenPv=lestenPv;
